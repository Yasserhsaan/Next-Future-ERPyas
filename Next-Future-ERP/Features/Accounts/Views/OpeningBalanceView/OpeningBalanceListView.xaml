<Page
    x:Class="Next_Future_ERP.Features.Accounts.Views.OpeningBalanceListView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:controls="clr-namespace:Wpf.Ui.Controls;assembly=Wpf.Ui"
    xmlns:core="clr-namespace:Next_Future_ERP.Core.Controls"
    xmlns:converters="clr-namespace:Next_Future_ERP.Features.Accounts.Converters"
    Title="الأرصدة الافتتاحية"
    FlowDirection="RightToLeft"
    Background="#F7F9FC">

    <Page.Resources>
        <converters:StatusToColorConverter x:Key="StatusToColorConverter"/>
        <Style TargetType="Button" x:Key="ToolbarBtn">
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Margin" Value="6,0,0,0"/>
        </Style>
        <Style TargetType="DataGrid">
            <Setter Property="RowHeight" Value="36"/>
            <Setter Property="AlternationCount" Value="2"/>
            <Setter Property="AlternatingRowBackground" Value="#FAFAFA"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="SelectionMode" Value="Single"/>
        </Style>
    </Page.Resources>

    <!-- نجعل كل العناصر تتراكم للأعلى -->
    <DockPanel Margin="12" LastChildFill="False">

        <!-- شريط الأدوات أعلى الصفحة -->
        <controls:Card DockPanel.Dock="Top" Padding="10" Margin="0,0,0,10">
            <core:CommandBar DataContext="{Binding}"
                             NewCommand="{Binding NewDialogCommand}"
                             EditCommand="{Binding EditDialogCommand}"
                             SaveCommand="{x:Null}"
                             DeleteCommand="{Binding DeleteCommand}"
                             RefreshCommand="{Binding RefreshCommand}"
                             SearchCommand="{Binding LoadCommand}" />
        </controls:Card>

        <!-- القائمة (الداتا جريد) مباشرة أسفل الشريط ومتراصة للأعلى) -->
        <controls:Card DockPanel.Dock="Top"
                       Padding="0"
                       VerticalContentAlignment="Top"
                       HorizontalContentAlignment="Stretch">
            <DataGrid ItemsSource="{Binding Items}"
                      SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                      AutoGenerateColumns="False"
                      MouseDoubleClick="DataGrid_MouseDoubleClick"
                      VerticalAlignment="Top"
                      ScrollViewer.VerticalScrollBarVisibility="Auto">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="الرقم" Binding="{Binding BatchId}" Width="80"/>
                    <DataGridTextColumn Header="رقم المستند" Binding="{Binding DocNo}" Width="120"/>
                    <DataGridTextColumn Header="التاريخ" Binding="{Binding DocDate, StringFormat=dd/MM/yyyy}" Width="100"/>
                    <DataGridTextColumn Header="السنة المالية" Binding="{Binding FiscalYear}" Width="100"/>
                    <DataGridTextColumn Header="الوصف" Binding="{Binding Description}" Width="*"/>
                    <DataGridTemplateColumn Header="الحالة" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Padding="8,4" CornerRadius="12" HorizontalAlignment="Center"
                                        Background="{Binding Status, Converter={StaticResource StatusToColorConverter}}">
                                    <TextBlock Text="{Binding StatusText}" 
                                               Foreground="White" 
                                               FontSize="11" 
                                               FontWeight="SemiBold"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="عدد السطور" Binding="{Binding Lines.Count}" Width="100"/>
                </DataGrid.Columns>

                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="تعديل"
                                  Command="{Binding DataContext.EditDialogCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
                        <MenuItem Header="حذف"
                                  Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
                    </ContextMenu>
                </DataGrid.ContextMenu>
            </DataGrid>
        </controls:Card>

    </DockPanel>
</Page>

