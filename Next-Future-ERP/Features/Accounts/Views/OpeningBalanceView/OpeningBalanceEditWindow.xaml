<Window x:Class="Next_Future_ERP.Features.Accounts.Views.OpeningBalanceEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:Next_Future_ERP.Features.Accounts.Converters"
        xmlns:accountControls="clr-namespace:Next_Future_ERP.Features.Accounts.Controls"
        Title="{Binding WindowTitle}" Height="900" Width="1400"
        WindowStartupLocation="CenterOwner"
        FlowDirection="RightToLeft"
        Background="#F7F9FC"
        ResizeMode="CanResizeWithGrip"
        MinWidth="1200" MinHeight="700"
        Loaded="Window_Loaded">

    <Window.InputBindings>
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SaveCommand}"/>
        <KeyBinding Key="Escape" Command="{Binding CancelCommand}"/>
    </Window.InputBindings>

    <Window.Resources>
        <!-- Ø£Ù„ÙˆØ§Ù† Ù…Ø­Ù„ÙŠØ© -->
        <SolidColorBrush x:Key="AccentBrush" Color="#FF2563EB"/>
        <SolidColorBrush x:Key="AccentTextBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="CardBorderBrush" Color="#E5E7EB"/>
        <SolidColorBrush x:Key="CardBackgroundBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#10B981"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#EF4444"/>
        <SolidColorBrush x:Key="WarningBrush" Color="#F59E0B"/>

        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:StatusToColorConverter x:Key="StatusToColorConverter"/>
        <converters:BalanceToColorConverter x:Key="BalanceToColorConverter"/>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:BalanceStatusConverter x:Key="BalanceStatusConverter"/>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø´Ø±ÙŠØ· -->
        <Style x:Key="IconButton" TargetType="Button">
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="MinWidth" Value="100"/>
        </Style>

        <!-- ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª ÙˆØ§Ù„Ø­Ù‚ÙˆÙ„ -->
        <Style x:Key="FormLabel" TargetType="TextBlock">
            <Setter Property="Margin" Value="0,0,0,4"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#374151"/>
        </Style>

        <Style x:Key="RightAlignedTextBox" TargetType="TextBox">
            <Setter Property="TextAlignment" Value="Right"/>
            <Setter Property="HorizontalContentAlignment" Value="Right"/>
            <Setter Property="Padding" Value="8"/>
        </Style>

        <!-- GroupBox Ø¨Ø´ÙƒÙ„ Ø¨Ø·Ø§Ù‚Ø© -->
        <Style TargetType="GroupBox">
            <Setter Property="Margin" Value="0,8,0,8"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Border BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Background="{StaticResource CardBackgroundBrush}"
                                CornerRadius="8">
                            <DockPanel>
                                <Border Background="{StaticResource AccentBrush}"
                                        CornerRadius="8,8,0,0"
                                        Padding="12,8"
                                        DockPanel.Dock="Top">
                                    <TextBlock Text="{TemplateBinding Header}"
                                               Foreground="{StaticResource AccentTextBrush}"
                                               FontWeight="SemiBold"
                                               FontSize="14"/>
                                </Border>
                                <ContentPresenter Margin="12"/>
                            </DockPanel>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- DataGrid ØªØ­Ø³ÙŠÙ†Ø§Øª -->
        <Style TargetType="DataGrid">
            <Setter Property="RowHeight" Value="40"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#F3F4F6"/>
            <Setter Property="AlternatingRowBackground" Value="#F9FAFB"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <!-- Status Badge Style -->
        <Style x:Key="StatusBadge" TargetType="Border">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
        </Style>
    </Window.Resources>

    <!-- =================== Main Layout =================== -->
    <DockPanel>
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø³ÙÙ„ÙŠ -->
        <Border DockPanel.Dock="Bottom" 
                Background="{StaticResource CardBackgroundBrush}"
                BorderBrush="{StaticResource CardBorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="16,12">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="ðŸ’¾ Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø©" 
                        Command="{Binding SaveCommand}" 
                        Style="{StaticResource IconButton}"
                        Background="{StaticResource AccentBrush}"
                        Foreground="White"
                        MinWidth="120"/>
                <Button Content="âœ… ØªØ±Ø­ÙŠÙ„" 
                        Command="{Binding PostCommand}" 
                        Style="{StaticResource IconButton}"
                        Background="{StaticResource SuccessBrush}"
                        Foreground="White"
                        MinWidth="120"
                        IsEnabled="{Binding IsEditable}"/>
                <Separator Width="1" Height="24" Background="{StaticResource CardBorderBrush}" Margin="8,0"/>
                <Button Content="ðŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel" 
                        Command="{Binding ImportFromExcelCommand}" 
                        Style="{StaticResource IconButton}"
                        Background="{StaticResource WarningBrush}"
                        Foreground="White"
                        MinWidth="130"
                        IsEnabled="{Binding IsEditable}"/>
                <Button Content="ðŸ“„ ØªÙ†Ø²ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬" 
                        Command="{Binding DownloadTemplateCommand}" 
                        Style="{StaticResource IconButton}"
                        Background="{StaticResource AccentBrush}"
                        Foreground="White"
                        MinWidth="130"
                        IsEnabled="{Binding IsEditable}"/>
                <Separator Width="1" Height="24" Background="{StaticResource CardBorderBrush}" Margin="8,0"/>
                <Button Content="Ø¥Ù„ØºØ§Ø¡" 
                        Command="{Binding CancelCommand}" 
                        Style="{StaticResource IconButton}"
                        MinWidth="100"/>
            </StackPanel>
        </Border>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
            <StackPanel>
                <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø±Ø£Ø³ Ø§Ù„Ø¯ÙØ¹Ø© -->
                <GroupBox Header="ðŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹Ø©">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ -->
                        <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,12,12">
                            <TextBlock Text="Ø§Ù„Ø´Ø±ÙƒØ©" Style="{StaticResource FormLabel}"/>
                            <ComboBox ItemsSource="{Binding Companies}"
                                      SelectedValue="{Binding SelectedCompanyId}"
                                      SelectedValuePath="CompId"
                                      DisplayMemberPath="CompName"
                                      IsEnabled="{Binding IsEditable}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,12,12">
                            <TextBlock Text="Ø§Ù„ÙØ±Ø¹" Style="{StaticResource FormLabel}"/>
                            <ComboBox ItemsSource="{Binding Branches}"
                                      SelectedValue="{Binding SelectedBranchId}"
                                      SelectedValuePath="BranchId"
                                      DisplayMemberPath="BranchName"
                                      IsEnabled="{Binding IsEditable}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,12,12">
                            <TextBlock Text="Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding FiscalYear, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource RightAlignedTextBox}"
                                     IsEnabled="{Binding IsEditable}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="0" Grid.Column="3">
                            <TextBlock Text="Ø§Ù„Ø­Ø§Ù„Ø©" Style="{StaticResource FormLabel}"/>
                            <Border Style="{StaticResource StatusBadge}"
                                    Background="{Binding CurrentBatch.Status, Converter={StaticResource StatusToColorConverter}}">
                                <TextBlock Text="{Binding StatusText}" 
                                           Foreground="White" 
                                           FontWeight="SemiBold"/>
                            </Border>
                        </StackPanel>

                        <!-- Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ -->
                        <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,12,12">
                            <TextBlock Text="Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding CurrentBatch.DocNo, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource RightAlignedTextBox}"
                                     IsEnabled="{Binding IsEditable}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,0,12,12">
                            <TextBlock Text="Ø§Ù„ØªØ§Ø±ÙŠØ®" Style="{StaticResource FormLabel}"/>
                            <DatePicker SelectedDate="{Binding CurrentBatch.DocDate}"
                                        FirstDayOfWeek="Saturday"
                                        IsEnabled="{Binding IsEditable}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="2" Grid.ColumnSpan="2">
                            <TextBlock Text="Ø§Ù„ÙˆØµÙ" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding CurrentBatch.Description, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource RightAlignedTextBox}"
                                     IsEnabled="{Binding IsEditable}"/>
                        </StackPanel>

                        <!-- Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« - Ø¹Ù…Ù„Ø© Ø§Ù„Ø´Ø±ÙƒØ© ÙˆØ§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…Ø§Ù„ÙŠØ© -->
                        <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,12,0">
                            <TextBlock Text="Ø¹Ù…Ù„Ø© Ø§Ù„Ø´Ø±ÙƒØ©" Style="{StaticResource FormLabel}"/>
                            <Border Background="#F3F4F6" 
                                    BorderBrush="{StaticResource CardBorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="8">
                                <TextBlock Text="{Binding CompanyCurrencyName}" 
                                           FontWeight="SemiBold"
                                           Foreground="#374151"/>
                            </Border>
                        </StackPanel>

                        <StackPanel Grid.Row="2" Grid.Column="1" Margin="0,0,12,0">
                            <TextBlock Text="Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…ØªØ§Ø­Ø©" Style="{StaticResource FormLabel}"/>
                            <Border Background="#F8FAFC" 
                                    BorderBrush="{StaticResource CardBorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="8">
                                <TextBlock FontWeight="SemiBold" Foreground="#374151">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚: {0}">
                                            <Binding Path="Funds.Count"/>
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </Border>
                        </StackPanel>

                        <StackPanel Grid.Row="2" Grid.Column="2" Margin="0,0,12,0">
                            <TextBlock Text="Ø§Ù„Ø¨Ù†ÙˆÙƒ Ø§Ù„Ù…ØªØ§Ø­Ø©" Style="{StaticResource FormLabel}"/>
                            <Border Background="#F8FAFC" 
                                    BorderBrush="{StaticResource CardBorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="8">
                                <TextBlock FontWeight="SemiBold" Foreground="#374151">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="Ø§Ù„Ø¨Ù†ÙˆÙƒ: {0}">
                                            <Binding Path="Banks.Count"/>
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </Border>
                        </StackPanel>
                    </Grid>
                </GroupBox>

                <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø·ÙˆØ± -->
                <GroupBox Header="ðŸ“Š Ø³Ø·ÙˆØ± Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ©">
                    <DockPanel>
                        <!-- Ø£Ø²Ø±Ø§Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø·ÙˆØ± -->
                        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,12">
                            <Button Content="âž• Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±" 
                                    Command="{Binding AddLineCommand}" 
                                    Style="{StaticResource IconButton}"
                                    Background="{StaticResource SuccessBrush}"
                                    Foreground="White"
                                    IsEnabled="{Binding IsEditable}"/>
                            <Button Content="âž– Ø­Ø°Ù Ø§Ù„Ø³Ø·Ø±" 
                                    Command="{Binding RemoveLineCommand}" 
                                    CommandParameter="{Binding SelectedLine}"
                                    Style="{StaticResource IconButton}"
                                    Background="{StaticResource ErrorBrush}"
                                    Foreground="White"
                                    IsEnabled="{Binding IsEditable}"/>
                        </StackPanel>

                        <!-- DataGrid Ù„Ù„Ø³Ø·ÙˆØ± -->
                        <DataGrid x:Name="LinesDataGrid"
                                  ItemsSource="{Binding Lines}" 
                                  SelectedItem="{Binding SelectedLine}"
                                  IsReadOnly="{Binding IsPosted}"
                                  LoadingRow="DataGrid_LoadingRow">
                            <DataGrid.Columns>
                                <!-- Ø±Ù‚Ù… Ø§Ù„Ø³Ø·Ø± -->
                                <DataGridTextColumn Header="#" 
                                                    Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=Header}" 
                                                    Width="40"
                                                    IsReadOnly="True"/>

                                <!-- Ø§Ù„Ø­Ø³Ø§Ø¨ -->
                                <DataGridTemplateColumn Header="Ø§Ù„Ø­Ø³Ø§Ø¨" Width="300">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding AccountDisplay}" Margin="4"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <accountControls:AccountSearchBox 
                                                AccountsSource="{Binding DataContext.Accounts, RelativeSource={RelativeSource AncestorType=Window}}"
                                                SelectedAccount="{Binding SelectedAccount, UpdateSourceTrigger=PropertyChanged}"
                                                AccountSelected="AccountSearchBox_AccountSelected"
                                                Margin="2"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                                <!-- Ù…Ø±ÙƒØ² Ø§Ù„ØªÙƒÙ„ÙØ© -->
                                <DataGridTemplateColumn Header="Ù…Ø±ÙƒØ² Ø§Ù„ØªÙƒÙ„ÙØ©" Width="150">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding CostCenterName}" Margin="4"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <ComboBox ItemsSource="{Binding DataContext.CostCenters, RelativeSource={RelativeSource AncestorType=Window}}"
                                                      SelectedValue="{Binding CostCenterId, UpdateSourceTrigger=PropertyChanged}"
                                                      SelectedValuePath="CostCenterId"
                                                      DisplayMemberPath="CostCenterName"
                                                      IsEnabled="{Binding UsesCostCenter}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                                <!-- Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© -->
                                <DataGridTemplateColumn Header="Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©" Width="120">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding TransactionCurrencyName}" Margin="4"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <ComboBox ItemsSource="{Binding DataContext.Currencies, RelativeSource={RelativeSource AncestorType=Window}}"
                                                      SelectedValue="{Binding TransactionCurrencyId, UpdateSourceTrigger=PropertyChanged}"
                                                      SelectedValuePath="CurrencyId"
                                                      DisplayMemberPath="CurrencyNameAr"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                                <!-- Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù -->
                                <DataGridTextColumn Header="Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù" 
                                                    Binding="{Binding ExchangeRate, StringFormat=N6, UpdateSourceTrigger=PropertyChanged}" 
                                                    Width="100">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextAlignment" Value="Right"/>
                                            <Setter Property="Margin" Value="4"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <!-- Ù…Ø¯ÙŠÙ† (Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©) -->
                                <DataGridTextColumn Header="Ù…Ø¯ÙŠÙ† (Ù…Ø¹Ø§Ù…Ù„Ø©)" 
                                                    Binding="{Binding TransactionDebit, StringFormat=N4, UpdateSourceTrigger=PropertyChanged}" 
                                                    Width="120">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextAlignment" Value="Right"/>
                                            <Setter Property="Margin" Value="4"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                    <DataGridTextColumn.EditingElementStyle>
                                        <Style TargetType="TextBox">
                                            <Setter Property="TextAlignment" Value="Right"/>
                                            <Setter Property="Margin" Value="4"/>
                                        </Style>
                                    </DataGridTextColumn.EditingElementStyle>
                                </DataGridTextColumn>

                                <!-- Ø¯Ø§Ø¦Ù† (Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©) -->
                                <DataGridTextColumn Header="Ø¯Ø§Ø¦Ù† (Ù…Ø¹Ø§Ù…Ù„Ø©)" 
                                                    Binding="{Binding TransactionCredit, StringFormat=N4, UpdateSourceTrigger=PropertyChanged}" 
                                                    Width="120">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextAlignment" Value="Right"/>
                                            <Setter Property="Margin" Value="4"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                    <DataGridTextColumn.EditingElementStyle>
                                        <Style TargetType="TextBox">
                                            <Setter Property="TextAlignment" Value="Right"/>
                                            <Setter Property="Margin" Value="4"/>
                                        </Style>
                                    </DataGridTextColumn.EditingElementStyle>
                                </DataGridTextColumn>

                                <!-- Ù…Ø¯ÙŠÙ† (Ø¹Ù…Ù„Ø© Ø§Ù„Ø´Ø±ÙƒØ©) -->
                                <DataGridTextColumn Header="Ù…Ø¯ÙŠÙ† (Ø´Ø±ÙƒØ©)" 
                                                    Binding="{Binding CompanyDebit, StringFormat=N4}" 
                                                    Width="120"
                                                    IsReadOnly="True">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextAlignment" Value="Right"/>
                                            <Setter Property="Margin" Value="4"/>
                                            <Setter Property="Background" Value="#F9FAFB"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <!-- Ø¯Ø§Ø¦Ù† (Ø¹Ù…Ù„Ø© Ø§Ù„Ø´Ø±ÙƒØ©) -->
                                <DataGridTextColumn Header="Ø¯Ø§Ø¦Ù† (Ø´Ø±ÙƒØ©)" 
                                                    Binding="{Binding CompanyCredit, StringFormat=N4}" 
                                                    Width="120"
                                                    IsReadOnly="True">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextAlignment" Value="Right"/>
                                            <Setter Property="Margin" Value="4"/>
                                            <Setter Property="Background" Value="#F9FAFB"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <!-- Ø§Ù„Ø¨ÙŠØ§Ù† -->
                                <DataGridTextColumn Header="Ø§Ù„Ø¨ÙŠØ§Ù†" 
                                                    Binding="{Binding Statement, UpdateSourceTrigger=PropertyChanged}" 
                                                    Width="*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextAlignment" Value="Right"/>
                                            <Setter Property="Margin" Value="4"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                    <DataGridTextColumn.EditingElementStyle>
                                        <Style TargetType="TextBox">
                                            <Setter Property="TextAlignment" Value="Right"/>
                                            <Setter Property="Margin" Value="4"/>
                                        </Style>
                                    </DataGridTextColumn.EditingElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>
                </GroupBox>

                <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª -->
                <GroupBox Header="ðŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª ÙˆØ§Ù„ØªÙˆØ§Ø²Ù†">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Margin="0,0,12,0">
                            <TextBlock Text="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†" Style="{StaticResource FormLabel}"/>
                            <Border Background="#FEF3F2" 
                                    BorderBrush="#FDA29B" 
                                    BorderThickness="1" 
                                    CornerRadius="4" 
                                    Padding="8">
                                <TextBlock Text="{Binding CompanyDebitTotal, StringFormat=N4}" 
                                           FontSize="16" 
                                           FontWeight="Bold"
                                           Foreground="#B91C1C"
                                           TextAlignment="Right"/>
                            </Border>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="0,0,12,0">
                            <TextBlock Text="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø§Ø¦Ù†" Style="{StaticResource FormLabel}"/>
                            <Border Background="#F0FDF4" 
                                    BorderBrush="#86EFAC" 
                                    BorderThickness="1" 
                                    CornerRadius="4" 
                                    Padding="8">
                                <TextBlock Text="{Binding CompanyCreditTotal, StringFormat=N4}" 
                                           FontSize="16" 
                                           FontWeight="Bold"
                                           Foreground="#166534"
                                           TextAlignment="Right"/>
                            </Border>
                        </StackPanel>

                        <StackPanel Grid.Column="2" Margin="0,0,12,0">
                            <TextBlock Text="ØµØ§ÙÙŠ Ø§Ù„Ø±ØµÙŠØ¯" Style="{StaticResource FormLabel}"/>
                            <Border CornerRadius="4" Padding="8"
                                    Background="{Binding CompanyNetBalance, Converter={StaticResource BalanceToColorConverter}}">
                                <TextBlock Text="{Binding CompanyNetBalance, StringFormat=N4}" 
                                           FontSize="16" 
                                           FontWeight="Bold"
                                           Foreground="White"
                                           TextAlignment="Right"/>
                            </Border>
                        </StackPanel>

                        <StackPanel Grid.Column="3">
                            <TextBlock Text="Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ§Ø²Ù†" Style="{StaticResource FormLabel}"/>
                            <Border CornerRadius="4" Padding="8"
                                    Background="{Binding IsBalanced, Converter={StaticResource BoolToColorConverter}}">
                                <TextBlock Text="{Binding IsBalanced, Converter={StaticResource BalanceStatusConverter}}"
                                           FontSize="16" 
                                           FontWeight="Bold"
                                           Foreground="White"
                                           TextAlignment="Center"/>
                            </Border>
                        </StackPanel>
                    </Grid>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</Window>

