<Window x:Class="Next_Future_ERP.Features.Accounts.Views.BankEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:controls="clr-namespace:Wpf.Ui.Controls;assembly=Wpf.Ui"
        Title="{Binding WindowTitle}" Height="700" Width="900"
        WindowStartupLocation="CenterOwner"
        FlowDirection="RightToLeft"
        Background="#F7F9FC"
        ResizeMode="CanResizeWithGrip"
        MinWidth="800" MinHeight="600"
        Loaded="Window_Loaded">

    <!-- Ø§Ø®ØªØµØ§Ø±Ø§Øª -->
    <Window.InputBindings>
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SaveCommand}"/>
        <KeyBinding Key="Escape" Command="{Binding CancelCommand}"/>
    </Window.InputBindings>

    <Window.Resources>
        <!-- Ø£Ù„ÙˆØ§Ù† -->
        <SolidColorBrush x:Key="CardBg" Color="#FFFFFFFF"/>
        <SolidColorBrush x:Key="CardBorder" Color="#E6EAF0"/>
        <SolidColorBrush x:Key="Soft" Color="#F3F4F6"/>
        <SolidColorBrush x:Key="Accent" Color="#3B82F6"/>
        <SolidColorBrush x:Key="AccentDark" Color="#2563EB"/>
        <SolidColorBrush x:Key="Muted" Color="#64748B"/>

        <!-- Ø­Ø§ÙˆÙŠØ© -->
        <Style x:Key="CardBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBg}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Padding" Value="14"/>
        </Style>

        <!-- Ù…Ø¯Ø®Ù„Ø§Øª -->
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
        </Style>
        <Style TargetType="DatePicker">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Margin" Value="0,8,0,0"/>
        </Style>
        <Style TargetType="Button" x:Key="PrimaryBtn">
            <Setter Property="Background" Value="{StaticResource Accent}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="BorderBrush" Value="{StaticResource AccentDark}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Ø£Ø²Ø±Ø§Ø± Ø£Ø¹Ù„Ù‰ -->
            <RowDefinition Height="Auto"/> <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
            <RowDefinition Height="*"/>     <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª -->
            <RowDefinition Height="Auto"/> <!-- ØªÙ„Ù…ÙŠØ­ Ø³ÙÙ„ÙŠ -->
        </Grid.RowDefinitions>

        <!-- Ø´Ø±ÙŠØ· Ø£Ø¹Ù„Ù‰ -->
        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
            <controls:Button Content="Ø­ÙØ¸" Width="130" Style="{StaticResource PrimaryBtn}"
                    Command="{Binding SaveCommand}" Margin="0,0,10,0"/>
            <controls:Button Content="Ø¥Ù„ØºØ§Ø¡" Width="110" Command="{Binding CancelCommand}"/>
        </StackPanel>

        <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <controls:Card Grid.Row="1" Padding="14" Margin="0,0,0,10">
            <Grid Margin="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ -->
                <StackPanel Grid.Column="0" Grid.Row="0" Margin="8">
                    <TextBlock Text="Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ" Foreground="{StaticResource Muted}" FontSize="12" Margin="0,0,0,4"/>
                    <controls:TextBox Text="{Binding Model.BankName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <!-- Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø§Ù„Ø¯Ù„ÙŠÙ„) -->
                <StackPanel Grid.Column="1" Grid.Row="0" Margin="8">
                    <TextBlock Text="Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø§Ù„Ø¯Ù„ÙŠÙ„)" Foreground="{StaticResource Muted}" FontSize="12" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding BankAccountOptions}"
                              SelectedValue="{Binding Model.AccountNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              SelectedValuePath="AccountCode"
                              DisplayMemberPath="AccountDisplay"
                              IsEditable="True"
                              IsTextSearchEnabled="True"
                              StaysOpenOnEdit="True"/>
                </StackPanel>

                <!-- Ø§Ù„Ø´Ø±ÙƒØ© -->
                <StackPanel Grid.Column="0" Grid.Row="1" Margin="8">
                    <TextBlock Text="Ø§Ù„Ø´Ø±ÙƒØ©" Foreground="{StaticResource Muted}" FontSize="12" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding CompanyOptions}"
                              SelectedValue="{Binding SelectedCompanyId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              SelectedValuePath="CompId"
                              DisplayMemberPath="CompName"/>
                </StackPanel>

                <!-- Ø§Ù„ÙØ±Ø¹ -->
                <StackPanel Grid.Column="1" Grid.Row="1" Margin="8">
                    <TextBlock Text="Ø§Ù„ÙØ±Ø¹" Foreground="{StaticResource Muted}" FontSize="12" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding BranchOptions}"
                              SelectedValue="{Binding SelectedBranchId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              SelectedValuePath="BranchId"
                              DisplayMemberPath="BranchName"/>
                </StackPanel>

                <!-- Ù†Ø´Ø· -->
                <StackPanel Grid.Column="0" Grid.Row="2" Margin="8">
                    <CheckBox Content="Ù†Ø´Ø·" 
                              IsChecked="{Binding Model.IsActive, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <!-- ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù -->
                <StackPanel Grid.Column="1" Grid.Row="2" Margin="8">
                    <TextBlock Text="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù" Foreground="{StaticResource Muted}" FontSize="12" Margin="0,0,0,4"/>
                    <DatePicker SelectedDate="{Binding Model.StopDate, Mode=TwoWay}"/>
                </StackPanel>

                <!-- Ø³Ø¨Ø¨ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù -->
                <StackPanel Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="3" Margin="8">
                    <TextBlock Text="Ø³Ø¨Ø¨ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù" Foreground="{StaticResource Muted}" FontSize="12" Margin="0,0,0,4"/>
                    <controls:TextBox Text="{Binding Model.StopReason, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
            </Grid>
        </controls:Card>

        <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª -->
        <controls:Card Grid.Row="2" Padding="14">
            <DockPanel>
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª" FontWeight="SemiBold" Foreground="#111827" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <controls:Button Content="Ø¥Ø¶Ø§ÙØ© ØµÙ" Command="{Binding AddDetailRowCommand}" Padding="8,4"/>
                </StackPanel>

                <DataGrid ItemsSource="{Binding DetailRows}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False" 
                          CanUserDeleteRows="False" 
                          IsReadOnly="False">
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Header="Ø§Ù„Ø¹Ù…Ù„Ø©" MinWidth="160">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <ComboBox ItemsSource="{Binding DataContext.CurrencyOptions, RelativeSource={RelativeSource AncestorType=Window}}"
                                              SelectedValuePath="CurrencyId"
                                              DisplayMemberPath="CurrencyNameAr"
                                              SelectedValue="{Binding CurrencyId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTextColumn Header="Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†Ùƒ" Binding="{Binding BankAccountNumber, UpdateSourceTrigger=PropertyChanged}" MinWidth="180" />

                        <DataGridTextColumn Header="Ø£Ø¯Ù†Ù‰ Ù†Ù‚Ø¯ÙŠ" Binding="{Binding MinCash, StringFormat=N2, UpdateSourceTrigger=PropertyChanged}" />
                        <DataGridTextColumn Header="Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø¯ÙŠ" Binding="{Binding MaxCash, StringFormat=N2, UpdateSourceTrigger=PropertyChanged}" />
                        <DataGridTextColumn Header="Ø£Ø¯Ù†Ù‰ Ø¹Ù…Ù„ÙŠØ©" Binding="{Binding MinTransaction, StringFormat=N2, UpdateSourceTrigger=PropertyChanged}" />
                        <DataGridTextColumn Header="Ø£Ø¹Ù„Ù‰ Ø¹Ù…Ù„ÙŠØ©" Binding="{Binding MaxTransaction, StringFormat=N2, UpdateSourceTrigger=PropertyChanged}" />
                        <DataGridCheckBoxColumn Header="ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ÙˆØ¯" Binding="{Binding AllowLimitExceed}" />

                        <DataGridTemplateColumn Header="Ø­Ø°Ù" Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="âœ–"
                                            Command="{Binding DataContext.RemoveDetailRowCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </controls:Card>

        <!-- Ø´Ø±ÙŠØ· Ø³ÙÙ„ÙŠ -->
        <TextBlock Grid.Row="3"
                   Text="ðŸ’¡ Ù†ØµÙŠØ­Ø©: ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù„Ø¡ Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ ÙˆØ§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø´Ø±ÙƒØ© ÙˆØ§Ù„ÙØ±Ø¹ Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸."
                   Foreground="{StaticResource Muted}" Margin="4,10,0,0"/>
    </Grid>
</Window>

