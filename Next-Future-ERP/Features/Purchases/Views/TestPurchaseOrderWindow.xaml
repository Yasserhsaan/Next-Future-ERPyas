<Window x:Class="Next_Future_ERP.Features.Purchases.Views.TestPurchaseOrderWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Next_Future_ERP.Features.Items.Controls"
        Title="{Binding WindowTitle}" 
        Height="700" Width="1200"
        MinWidth="1000" MinHeight="600"
        FlowDirection="RightToLeft"
        WindowStartupLocation="CenterOwner"
        Background="#F6F7F9"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <!-- Ø£Ù„ÙˆØ§Ù† -->
        <SolidColorBrush x:Key="Clr.Surface" Color="#FFFFFFFF"/>
        <SolidColorBrush x:Key="Clr.SurfaceAlt" Color="#FAFBFD"/>
        <SolidColorBrush x:Key="Clr.Border" Color="#E6EAF0"/>
        <SolidColorBrush x:Key="Clr.BorderStrong" Color="#D5DAE2"/>
        <SolidColorBrush x:Key="Clr.Muted" Color="#6B7280"/>
        <SolidColorBrush x:Key="Clr.Primary" Color="#0A6ED1"/>
        <SolidColorBrush x:Key="Clr.PrimaryDark" Color="#0854A0"/>
        <SolidColorBrush x:Key="Clr.TableHeader" Color="#F2F5F9"/>

        <!-- Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª -->
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource Clr.Surface}"/>
            <Setter Property="CornerRadius" Value="14"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#1F000000" BlurRadius="10" ShadowDepth="1" Opacity="0.25"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù†ØµÙˆØµ -->
        <Style x:Key="SectionTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#111827"/>
        </Style>
        <Style x:Key="Caption" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource Clr.Muted}"/>
        </Style>

        <!-- Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª -->
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Margin" Value="0,4,0,0"/>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Margin" Value="0,4,0,0"/>
            <Setter Property="IsEditable" Value="False"/>
        </Style>
        <Style TargetType="DatePicker">
            <Setter Property="Margin" Value="0,4,0,0"/>
        </Style>

        <!-- Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
        <Style x:Key="Btn.Primary" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource Clr.Primary}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.PrimaryDark}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>
        <Style x:Key="Btn.Secondary" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource Clr.SurfaceAlt}"/>
            <Setter Property="Foreground" Value="#111827"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="MinWidth" Value="110"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.BorderStrong}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- Ø£Ù†Ù…Ø§Ø· DataGrid -->
        <Style TargetType="DataGrid">
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="RowHeight" Value="36"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="AlternationCount" Value="2"/>
            <Setter Property="AlternatingRowBackground" Value="#FBFCFE"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
            <Setter Property="SelectionMode" Value="Single"/>
        </Style>
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="{StaticResource Clr.TableHeader}"/>
            <Setter Property="Foreground" Value="#374151"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
        </Style>
        <Style TargetType="DataGridRow">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
        </Style>
        <Style TargetType="DataGridCell">
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="8,4"/>
        </Style>

        <!-- Ø£Ù„ÙˆØ§Ù† Ø§Ù„ØªÙ…ÙŠÙŠØ² -->
        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#D6E6FB"/>
        <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="#D6E6FB"/>
    </Window.Resources>

    <DockPanel LastChildFill="True">
        <!-- Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ -->
        <Border Background="White" DockPanel.Dock="Top" BorderBrush="{StaticResource Clr.Border}" BorderThickness="0,0,0,1" Padding="12,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Ø¹Ù†ÙˆØ§Ù† -->
                <TextBlock Text="{Binding WindowTitle}" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>

                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Ø­ÙØ¸" Command="{Binding SaveCommand}" Style="{StaticResource Btn.Primary}" Margin="0,0,8,0"/>
                    <Button Content="Ø¥Ù„ØºØ§Ø¡" Command="{Binding CancelCommand}" Style="{StaticResource Btn.Secondary}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
        <ScrollViewer Padding="16">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="14"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="14"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Ø¨Ø·Ø§Ù‚Ø©: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ†Ø¯ -->
                <Border Grid.Row="0" Style="{StaticResource Card}">
                    <Grid Margin="4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1.1*"/>
                            <ColumnDefinition Width="1.1*"/>
                            <ColumnDefinition Width="1.1*"/>
                            <ColumnDefinition Width="1.1*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù… -->
                        <TextBlock Grid.Row="0" Grid.ColumnSpan="5" Text="Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ†Ø¯" Style="{StaticResource SectionTitle}" Margin="0,0,0,8"/>

                        <!-- ØµÙ Ø§Ù„Ø­Ù‚ÙˆÙ„ -->
                        <StackPanel Grid.Row="1" Grid.Column="0" Margin="8">
                            <TextBlock Text="Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯" Style="{StaticResource Caption}"/>
                            <TextBox Text="{Binding Model.TxnNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="1" Margin="8">
                            <TextBlock Text="Ø§Ù„ØªØ§Ø±ÙŠØ®" Style="{StaticResource Caption}"/>
                            <DatePicker SelectedDate="{Binding Model.TxnDate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="2" Margin="8">
                            <TextBlock Text="Ø§Ù„Ù…ÙˆØ±Ù‘Ø¯" Style="{StaticResource Caption}"/>
                            <ComboBox ItemsSource="{Binding Suppliers}"
                                      SelectedValuePath="SupplierID"
                                      DisplayMemberPath="SupplierName"
                                      SelectedValue="{Binding Model.SupplierID, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="3" Margin="8">
                            <TextBlock Text="Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…ØªÙˆÙ‚Ø¹" Style="{StaticResource Caption}"/>
                            <DatePicker SelectedDate="{Binding Model.ExpectedDelivery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="4" Margin="8">
                            <TextBlock Text="Ø§Ù„Ø­Ø§Ù„Ø©" Style="{StaticResource Caption}"/>
                            <ComboBox SelectedValue="{Binding Model.Status, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                      SelectedValuePath="Tag">
                                <ComboBoxItem Content="Ù…Ø³ÙˆØ¯Ø©" Tag="0"/>
                                <ComboBoxItem Content="Ù…Ø±Ø­Ù„"  Tag="1"/>
                                <ComboBoxItem Content="Ù…Ø¹ØªÙ…Ø¯" Tag="2"/>
                                <ComboBoxItem Content="Ù…Ù„ØºÙŠ"  Tag="9"/>
                            </ComboBox>
                        </StackPanel>

                        <!-- ØµÙ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
                        <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="5" Margin="8">
                            <TextBlock Text="Ù…Ù„Ø§Ø­Ø¸Ø§Øª" Style="{StaticResource Caption}"/>
                            <TextBox Text="{Binding Model.Remarks, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     AcceptsReturn="True" Height="64" TextWrapping="Wrap"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Ø¨Ø·Ø§Ù‚Ø©: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙ†Ù -->
                <Border Grid.Row="2" Style="{StaticResource Card}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù… -->
                        <TextBlock Text="Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙ†Ù" Style="{StaticResource SectionTitle}" Margin="0,0,0,8"/>

                        <!-- UserControl Ù„Ù„Ø¨Ø­Ø« -->
                        <StackPanel Grid.Row="1">
                            <TextBlock Text="Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù" Style="{StaticResource Caption}"/>
                            <local:ItemSearchBox x:Name="ItemSearchControl"
                                                  ItemSelected="ItemSearchControl_ItemSelected" Loaded="ItemSearchControl_Loaded"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
                <Border Grid.Row="4" Style="{StaticResource Card}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Ø¹Ù†ÙˆØ§Ù† -->
                        <TextBlock Text="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯" Style="{StaticResource SectionTitle}" Margin="0,0,0,4"/>

                        <!-- Ø£Ø²Ø±Ø§Ø± -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,32,0,0">
                            <Button Content="Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±" Style="{StaticResource Btn.Primary}"
                                    Command="{Binding AddRowCommand}" Margin="0,0,8,0"/>
                            <Button Content="Ø­Ø°Ù Ø§Ù„Ø³Ø·Ø±" Style="{StaticResource Btn.Secondary}"
                                    Command="{Binding RemoveRowCommand}" Margin="0,0,8,0"/>
                            <Button Content="Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨" Style="{StaticResource Btn.Secondary}"
                                    Command="{Binding RecalcTotalsCommand}"/>
                        </StackPanel>

                        <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
                        <DataGrid Name="DataGrid"
                                  Grid.Row="2"
                                  ItemsSource="{Binding Details}"
                                  SelectedItem="{Binding SelectedDetail}"
                                  AlternatingRowBackground="#F8FAFF">
                            <DataGrid.Columns>
                                <!-- Ø¹Ù…ÙˆØ¯ Ø§Ù„ØµÙ†Ù Ù…Ø¹ ItemSearchBox -->
                                <DataGridTemplateColumn Header="Ø§Ù„ØµÙ†Ù" Width="200">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <local:ItemSearchBox x:Name="ItemSearchBox"
                                                                 Loaded="ItemSearchBox_Loaded"
                                                                 ItemSelected="ItemSearchBox_ItemSelected"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                
                                <DataGridTextColumn Header="Ø§Ù„ÙƒÙ…ÙŠØ©"
                                                    Binding="{Binding Quantity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N3}}"
                                                    Width="110"/>
                                <DataGridTextColumn Header="Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©"
                                                    Binding="{Binding UnitPrice, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N3}}"
                                                    Width="130"/>
                                <DataGridTextColumn Header="Ø®Ø§Ø¶Ø¹ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø©"
                                                    Binding="{Binding TaxableAmount, StringFormat={}{0:N3}}"
                                                    Width="140"
                                                    IsReadOnly="True"/>
                                <DataGridTextColumn Header="%Ø¶Ø±ÙŠØ¨Ø©"
                                                    Binding="{Binding VATRate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N2}}"
                                                    Width="100"/>
                                <DataGridTextColumn Header="Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"
                                                    Binding="{Binding VATAmount, StringFormat={}{0:N3}}"
                                                    Width="140"
                                                    IsReadOnly="True"/>
                                <DataGridTextColumn Header="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ"
                                                    Binding="{Binding LineTotal, StringFormat={}{0:N3}}"
                                                    Width="140"
                                                    IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª -->
                        <Grid Grid.Row="3" Margin="0,14,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="12"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="12"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="220"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª" Style="{StaticResource SectionTitle}" VerticalAlignment="Center"/>

                            <TextBlock Grid.Column="1" Text="Ø§Ù„ØµØ§ÙÙŠ" VerticalAlignment="Center" Margin="8,0"/>
                            <TextBox Grid.Column="2" Text="{Binding Model.SubTotal, StringFormat=\{0:N2\}}"
                                     IsReadOnly="True" HorizontalContentAlignment="Right"/>

                            <TextBlock Grid.Column="4" Text="Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©" VerticalAlignment="Center" Margin="8,0"/>
                            <TextBox Grid.Column="5" Text="{Binding Model.TaxAmount, StringFormat=\{0:N2\}}"
                                     IsReadOnly="True" HorizontalContentAlignment="Right"/>

                            <TextBlock Grid.Column="7" Text="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" VerticalAlignment="Center" Margin="8,0"/>
                            <TextBox Grid.Column="8" Text="{Binding Model.TotalAmount, StringFormat=\{0:N2\}}"
                                     IsReadOnly="True" HorizontalContentAlignment="Right"/>
                        </Grid>
                    </Grid>
                </Border>

                <!-- ØªÙ„Ù…ÙŠØ­ -->
                <TextBlock Grid.Row="5" Margin="4,10,0,0"
                           Text="ðŸ’¡ Ù†ØµÙŠØ­Ø©: Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙ†Ù Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ØµÙ†Ø§Ù Ø¨Ø³Ù‡ÙˆÙ„Ø©."
                           Foreground="{StaticResource Clr.Muted}"/>
            </Grid>
        </ScrollViewer>
    </DockPanel>
</Window>
