<Page
    x:Class="Next_Future_ERP.Features.Payments.Views.PaymentMethodsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="طرق الدفع"
    FlowDirection="RightToLeft">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
        </Grid.RowDefinitions>

        <!-- شريط الأزرار + فلاتر -->
        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
            <Button Content="جديد"   Width="110" Margin="5" Command="{Binding NewCommand}"/>
            <Button Content="حفظ"    Width="110" Margin="5" Command="{Binding SaveCommand}"/>
            <Button Content="حذف"    Width="110" Margin="5" Command="{Binding DeleteCommand}"/>
            <Button Content="تحديث"  Width="110" Margin="5" Command="{Binding LoadCommand}"/>

            <StackPanel Orientation="Horizontal" Margin="16,0,0,0" VerticalAlignment="Center">
                <TextBlock Text="النوع:" Margin="0,0,6,0" VerticalAlignment="Center"/>
                <ComboBox Width="180"
                          ItemsSource="{Binding PaymentTypes}"
                          SelectedValue="{Binding SelectedTypeFilter, Mode=TwoWay}"
                          SelectedValuePath="TypeId"
                          DisplayMemberPath="Description"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="16,0,0,0" VerticalAlignment="Center">
                <TextBlock Text="بحث:" Margin="8,0,6,0" VerticalAlignment="Center"/>
                <TextBox Width="220" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>
        </StackPanel>

        <!-- إدخال -->
        <GroupBox Header="طريقة دفع" Grid.Row="1" Margin="0,0,0,12">
            <Grid Margin="8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="260"/>
                    <ColumnDefinition Width="220"/>
                    <ColumnDefinition Width="220"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Column="0" Margin="5">
                    <TextBlock Text="الاسم" Margin="0,0,0,4"/>
                    <TextBox Text="{Binding Current.MethodName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Margin="5">
                    <TextBlock Text="حساب GL" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding BankAccounts}"
                              SelectedValue="{Binding Current.GLAccount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              SelectedValuePath="AccountCode"
                              DisplayMemberPath="AccountDisplay"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Margin="5">
                    <TextBlock Text="نوع الدفع" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding PaymentTypes}"
                              SelectedValue="{Binding Current.PaymentTypeId, Mode=TwoWay}"
                              SelectedValuePath="TypeId"
                              DisplayMemberPath="Description"/>
                </StackPanel>

                <StackPanel Grid.Column="0" Grid.Row="1" Margin="5">
                    <TextBlock Text="مزود (اختياري)" Margin="0,0,0,4"/>
                    <TextBox x:Name="txtProviderId"
                             PreviewTextInput="OnlyDigits_PreviewTextInput"
                             DataObject.Pasting="OnlyDigits_Pasting"
                             Text="{Binding Current.ProviderId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Grid.Row="1" Margin="5" Orientation="Horizontal" VerticalAlignment="Bottom">
                    <CheckBox Content="تتطلب موافقة" IsChecked="{Binding Current.RequiresApproval}"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Grid.Row="1" Margin="5" Orientation="Horizontal" VerticalAlignment="Bottom">
                    <CheckBox Content="مفعّلة" IsChecked="{Binding Current.IsActive}"/>
                </StackPanel>

                <StackPanel Grid.Column="3" Grid.Row="1" Margin="5" Orientation="Horizontal" VerticalAlignment="Bottom">
                    <CheckBox Content="تدعم التجزئة" IsChecked="{Binding Current.SupportsSplit}"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- الجدول -->
        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding Items}"
                  SelectedItem="{Binding Current, Mode=TwoWay}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  IsReadOnly="True"
                  SelectionMode="Single">
            <DataGrid.Columns>
                <DataGridTextColumn Header="الطريقة"     Binding="{Binding MethodName}" Width="*"/>
                <DataGridTextColumn Header="GL Account"  Binding="{Binding GLAccount}"   Width="200"/>
                <DataGridTextColumn Header="النوع"       Binding="{Binding Type.Description}" Width="200"/>
                <DataGridCheckBoxColumn Header="مفعّلة"  Binding="{Binding IsActive}"    Width="80"/>
                <DataGridCheckBoxColumn Header="موافقة"  Binding="{Binding RequiresApproval}" Width="80"/>
                <DataGridCheckBoxColumn Header="تجزئة"   Binding="{Binding SupportsSplit}" Width="80"/>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Page>
