<UserControl x:Class="Next_Future_ERP.Features.Items.Views.ItemPricesView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      FlowDirection="RightToLeft"
      Background="#F7F9FC">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        
        <SolidColorBrush x:Key="Primary"     Color="#2563EB"/>
        <SolidColorBrush x:Key="PrimaryDark" Color="#1E40AF"/>
        <SolidColorBrush x:Key="CardBorder"  Color="#E2E8F0"/>
        <SolidColorBrush x:Key="AltRow"      Color="#FAFAFA"/>

        <Style TargetType="Button" x:Key="PrimaryBtn">
            <Setter Property="Background" Value="{StaticResource Primary}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="BorderBrush" Value="{StaticResource PrimaryDark}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="6,0,0,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" CornerRadius="10"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="10,2"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="{StaticResource PrimaryDark}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="bd" Property="Opacity" Value="0.5"/>
                                <Setter Property="Cursor" Value="Arrow"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button" x:Key="GhostBtn" BasedOn="{StaticResource PrimaryBtn}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#0F172A"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
        </Style>

        <Style TargetType="DataGrid">
            <Setter Property="RowHeight" Value="38"/>
            <Setter Property="FontSize" Value="13.5"/>
            <Setter Property="AlternationCount" Value="2"/>
            <Setter Property="AlternatingRowBackground" Value="{StaticResource AltRow}"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£ÙˆØ§Ù…Ø± -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,12">
                    <Button Content="Ø¬Ø¯ÙŠØ¯"   Width="110" Style="{StaticResource GhostBtn}"   Command="{Binding NewCommand}"/>
                    <Button Content="Ø­ÙØ¸"    Width="110" Style="{StaticResource PrimaryBtn}" Command="{Binding SaveCommand}"/>
                    <Button Content="Ø­Ø°Ù"    Width="110" Style="{StaticResource GhostBtn}"   Command="{Binding DeleteCommand}"/>
                    <Button Content="ØªØ­Ø¯ÙŠØ«"  Width="110" Style="{StaticResource GhostBtn}"   Command="{Binding RefreshCommand}"/>
        </StackPanel>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø±ÙŠØ¹ -->
        <Border Grid.Row="1" Background="#F3F4F6" CornerRadius="10" Padding="12" Margin="0,0,0,12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="250"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Ø§Ù„ØµÙ†Ù -->
                <StackPanel Grid.Column="0" Margin="6" Visibility="{Binding ShowItemSelector, Converter={StaticResource BoolToVisibility}}">
                    <TextBlock Text="Ø§Ù„ØµÙ†Ù" FontWeight="SemiBold" Foreground="#111827" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding AllItems}"
                              SelectedValue="{Binding SelectedItemIdForEdit, Mode=TwoWay}"
                              SelectedValuePath="Id"
                              DisplayMemberPath="Name"
                              Height="40"/>
                </StackPanel>

                <!-- Ù†ÙˆØ¹ Ø§Ù„ØªÙƒÙ„ÙØ© -->
                <StackPanel Margin="6">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Grid.Column" Value="1"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ShowItemSelector}" Value="False">
                                    <Setter Property="Grid.Column" Value="0"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="Ù†ÙˆØ¹ Ø§Ù„ØªÙƒÙ„ÙØ©" FontWeight="SemiBold" Foreground="#111827" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding PriceTypes}"
                              SelectedValue="{Binding Edit.PriceType, Mode=TwoWay}"
                              SelectedValuePath="Id"
                              DisplayMemberPath="Name"
                              Height="40"/>
                </StackPanel>

                <!-- Ø§Ù„Ù…Ø³ØªÙˆÙ‰ -->
                <StackPanel Margin="6">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Grid.Column" Value="2"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ShowItemSelector}" Value="False">
                                    <Setter Property="Grid.Column" Value="1"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="Ø§Ù„Ù…Ø³ØªÙˆÙ‰" FontWeight="SemiBold" Foreground="#111827" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding PriceLevels}"
                              SelectedValue="{Binding Edit.PriceLevelId, Mode=TwoWay}"
                              SelectedValuePath="Id"
                              DisplayMemberPath="Name"
                              Height="40"/>
                </StackPanel>

                <!-- Ø§Ù„ÙˆØ­Ø¯Ø© -->
                <StackPanel Margin="6">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Grid.Column" Value="3"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ShowItemSelector}" Value="False">
                                    <Setter Property="Grid.Column" Value="2"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="Ø§Ù„ÙˆØ­Ø¯Ø©" FontWeight="SemiBold" Foreground="#111827" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding AllUnits}"
                              SelectedValue="{Binding Edit.UnitID, Mode=TwoWay}"
                              SelectedValuePath="UnitID"
                              DisplayMemberPath="UnitName"
                              Height="40"/>
                </StackPanel>

                <!-- Ø§Ù„Ù‚ÙŠÙ…Ø© -->
                <StackPanel Margin="6">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Grid.Column" Value="4"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ShowItemSelector}" Value="False">
                                    <Setter Property="Grid.Column" Value="3"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="Ø§Ù„Ù‚ÙŠÙ…Ø©" FontWeight="SemiBold" Foreground="#111827" Margin="0,0,0,4"/>
                    <TextBox Text="{Binding Edit.PriceAmount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" 
                             Height="40" TextAlignment="Right"/>
                </StackPanel>

                <!-- Ø§Ù„Ù†Ø³Ø¨Ø© -->
                <StackPanel Margin="6">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Grid.Column" Value="5"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ShowItemSelector}" Value="False">
                                    <Setter Property="Grid.Column" Value="4"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="Ø§Ù„Ù†Ø³Ø¨Ø© %" FontWeight="SemiBold" Foreground="#111827" Margin="0,0,0,4"/>
                    <TextBox Text="{Binding Edit.PricePercent, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" 
                             Height="40" TextAlignment="Right"/>
                </StackPanel>

                <!-- Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ -->
                <StackPanel Margin="6">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Grid.Column" Value="6"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ShowItemSelector}" Value="False">
                                    <Setter Property="Grid.Column" Value="5"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹" FontWeight="SemiBold" Foreground="#111827" Margin="0,0,0,4"/>
                    <TextBox Text="{Binding Edit.SellPrice, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" 
                             Height="40" TextAlignment="Right" Background="#E8F5E8"/>
                </StackPanel>

                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom" Margin="6">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Grid.Column" Value="7"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ShowItemSelector}" Value="False">
                                    <Setter Property="Grid.Column" Value="6"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <CheckBox Content="Ù†Ø´Ø·" IsChecked="{Binding Edit.IsActive}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                </StackPanel>

                <!-- Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø·Ø±ÙŠÙ‚Ø© -->
                <StackPanel Grid.Row="1" Margin="6,8,6,0">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Grid.Column" Value="0"/>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨" FontWeight="SemiBold" Foreground="#111827" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding Methods}"
                              SelectedValue="{Binding Edit.Method, Mode=TwoWay}"
                              SelectedValuePath="Id"
                              DisplayMemberPath="Name"
                              Height="40"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Margin="6,8,6,0">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Grid.Column" Value="1"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ShowItemSelector}" Value="False">
                                    <Setter Property="Grid.Column" Value="1"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="Ø³Ø§Ø±ÙŠ Ù…Ù†" FontWeight="SemiBold" Foreground="#111827" Margin="0,0,0,4"/>
                    <DatePicker SelectedDate="{Binding Edit.EffectiveFrom, Mode=TwoWay}" Height="40"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Margin="6,8,6,0">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Grid.Column" Value="2"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ShowItemSelector}" Value="False">
                                    <Setter Property="Grid.Column" Value="2"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="Ø³Ø§Ø±ÙŠ Ø¥Ù„Ù‰" FontWeight="SemiBold" Foreground="#111827" Margin="0,0,0,4"/>
                    <DatePicker SelectedDate="{Binding Edit.EffectiveTo, Mode=TwoWay}" Height="40"/>
                </StackPanel>

                <!-- Ø²Ø± Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" VerticalAlignment="Bottom" Margin="6,8,6,0">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Grid.Column" Value="7"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ShowItemSelector}" Value="False">
                                    <Setter Property="Grid.Column" Value="6"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <Button Content="Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ«" Width="120" Style="{StaticResource PrimaryBtn}" 
                            Command="{Binding SaveCommand}" Height="32"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding Items}"
                  SelectedItem="{Binding SelectedRow, Mode=TwoWay}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  RowHeaderWidth="0"
                  AlternationCount="2">
            <DataGrid.Columns>
                <DataGridTextColumn Header="#" Binding="{Binding PriceID}" Width="60" IsReadOnly="True"/>
                
                <!-- Ø¹Ù…ÙˆØ¯ Ø§Ù„ØµÙ†Ù - ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ù„Ø© -->
                <DataGridTextColumn Header="Ø§Ù„ØµÙ†Ù" Binding="{Binding ItemName}" Width="220"
                                    Visibility="{Binding ShowItemSelector, Converter={StaticResource BoolToVisibility}}"/>
                
                <DataGridTextColumn Header="Ù†ÙˆØ¹ Ø§Ù„ØªÙƒÙ„ÙØ©" Binding="{Binding PriceTypeName}" Width="180"/>
                <DataGridTextColumn Header="Ø§Ù„Ù…Ø³ØªÙˆÙ‰" Binding="{Binding PriceLevelName}" Width="120"/>
                <DataGridTextColumn Header="Ø§Ù„ÙˆØ­Ø¯Ø©" Binding="{Binding UnitName}" Width="150"/>
                <DataGridTextColumn Header="Ø§Ù„Ù‚ÙŠÙ…Ø©" Binding="{Binding PriceAmount, StringFormat=N2}" Width="150"/>
                <DataGridTextColumn Header="Ø§Ù„Ù†Ø³Ø¨Ø© %" Binding="{Binding PricePercent, StringFormat=N2}" Width="120"/>
                <DataGridTextColumn Header="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹" Binding="{Binding SellPrice, StringFormat=N2}" Width="150"/>
                <DataGridTextColumn Header="Ù…Ù†" Binding="{Binding EffectiveFrom, StringFormat=\{0:yyyy-MM-dd\}}" Width="130"/>
                <DataGridTextColumn Header="Ø¥Ù„Ù‰" Binding="{Binding EffectiveTo, StringFormat=\{0:yyyy-MM-dd\}}" Width="130"/>
                <DataGridCheckBoxColumn Header="Ù†Ø´Ø·" Binding="{Binding IsActive}" Width="90"/>

                <!-- Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
                <DataGridTemplateColumn Header="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <!-- Ø²Ø± ØªØ¹Ø¯ÙŠÙ„ -->
                                <Button Width="35" Height="30" 
                                        Style="{StaticResource GhostBtn}" 
                                        Command="{Binding DataContext.EditPriceCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}"
                                        ToolTip="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±"
                                        Margin="2,0"
                                        Background="#E3F2FD"
                                        BorderBrush="#2196F3">
                                    <TextBlock Text="âœï¸" FontSize="12" Foreground="#1565C0"/>
                                </Button>
                                
                                <!-- Ø²Ø± Ø­Ø°Ù -->
                                <Button Width="35" Height="30" 
                                        Style="{StaticResource GhostBtn}" 
                                        Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}"
                                        ToolTip="Ø­Ø°Ù Ø§Ù„Ø³Ø¹Ø±"
                                        Margin="2,0"
                                        Background="#FFEBEE"
                                        BorderBrush="#F44336">
                                    <TextBlock Text="ðŸ—‘ï¸" FontSize="12" Foreground="#C62828"/>
                                </Button>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</UserControl>
