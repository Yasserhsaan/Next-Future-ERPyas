<ui:FluentWindow
    x:Class="Next_Future_ERP.Features.Items.Views.ItemEditWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:controls="clr-namespace:Wpf.Ui.Controls;assembly=Wpf.Ui"
    xmlns:views="clr-namespace:Next_Future_ERP.Features.Items.Views"
    xmlns:converters="clr-namespace:Next_Future_ERP.Converters;assembly=Next-Future-ERP"
    mc:Ignorable="d"
    Title="ÿµŸÜŸÅ"
    Height="700" Width="1200"
    FlowDirection="RightToLeft"
    WindowStartupLocation="CenterOwner"
    ResizeMode="CanResizeWithGrip"
    UseLayoutRounding="True"
    SnapsToDevicePixels="True"
    FontSize="14"
    Loaded="Window_Loaded">

    <!-- ŸÖŸàÿßÿ±ÿØ ŸÖÿ≠ÿ≥ŸÜÿ© -->
    <ui:FluentWindow.Resources>
        <!-- ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© -->
        <SolidColorBrush x:Key="PrimaryColor" Color="#3B82F6"/>
        <SolidColorBrush x:Key="SecondaryColor" Color="#64748B"/>
        <SolidColorBrush x:Key="SuccessColor" Color="#10B981"/>
        <SolidColorBrush x:Key="WarningColor" Color="#F59E0B"/>
        <SolidColorBrush x:Key="ErrorColor" Color="#EF4444"/>
        <SolidColorBrush x:Key="BackgroundColor" Color="#F8FAFC"/>
        <SolidColorBrush x:Key="SurfaceColor" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="BorderColor" Color="#E2E8F0"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#111827"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#64748B"/>
        
        <!-- Typography ŸÖÿ≠ÿ≥ŸÜ -->
        <Style x:Key="Heading1" TargetType="TextBlock">
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
        </Style>
        
        <Style x:Key="Heading2" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
        </Style>
        
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        
        
        <Style TargetType="TextBlock" x:Key="Label">
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>
        
        <!-- DataGrid Style ŸÖÿ≠ÿ≥ŸÜ -->
        <Style x:Key="ModernDataGrid" TargetType="DataGrid">
            <Setter Property="Background" Value="{StaticResource SurfaceColor}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="RowBackground" Value="{StaticResource SurfaceColor}"/>
            <Setter Property="AlternatingRowBackground" Value="#FAFAFA"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="RowHeight" Value="35"/>
        </Style>
        
        <!-- DataGridColumnHeader Style ŸÖÿ≠ÿ≥ŸÜ -->
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="{StaticResource BackgroundColor}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>
        
        <!-- Button Style ŸÖÿ≠ÿ≥ŸÜ -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#2563EB"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#1D4ED8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource BackgroundColor}"/>
            <Setter Property="Foreground" Value="{StaticResource SecondaryColor}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F1F5F9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        

        <!-- ÿ£ŸäŸÇŸàŸÜÿßÿ™ MDL2 -->
        <Style x:Key="IconText" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Margin" Value="0,0,6,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </ui:FluentWindow.Resources>

    <Grid Margin="14">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
        </Grid.RowDefinitions>

        <!-- ÿ¥ÿ±Ÿäÿ∑ ÿπŸÑŸàŸä -->
        <controls:Card Grid.Row="0" Padding="12" Margin="0,0,0,12">
            <DockPanel LastChildFill="False">
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                    <Button Style="{StaticResource PrimaryButton}" Command="{Binding SaveCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource IconText}" Text="&#xE74E;" Margin="0,0,6,0"/>
                            <TextBlock Text="ÿ≠ŸÅÿ∏" FontSize="15"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource SecondaryButton}" Margin="10,0,0,0" Command="{Binding CancelCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource IconText}" Text="&#xE711;" Margin="0,0,6,0"/>
                            <TextBlock Text="ÿ•ŸÑÿ∫ÿßÿ°" FontSize="15"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                
                <TextBlock VerticalAlignment="Center" FontWeight="SemiBold" Foreground="#111827" FontSize="18">
                    ÿ™ÿ≠ÿ±Ÿäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿµŸÜŸÅ
                </TextBlock>
            </DockPanel>
        </controls:Card>

        <!-- ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ: ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ŸÖÿ™ÿπÿØÿØÿ© -->
        <controls:Card Grid.Row="1" Padding="0,0,0,16">
            <!-- ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ -->
            <Grid>
                <ProgressBar IsIndeterminate="True" 
                             Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"
                             Height="3" 
                             VerticalAlignment="Top"
                             Background="{StaticResource PrimaryColor}"
                             Foreground="{StaticResource PrimaryColor}"/>
                
                <TabControl TabStripPlacement="Top" FontSize="14" Background="White" SelectionChanged="TabControl_SelectionChanged">
                <TabControl.Resources>
                    <!-- ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ™ÿµŸÖŸäŸÖ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™ -->
                    <Style TargetType="TabItem">
                        <Setter Property="Padding" Value="12,8"/>
                        <Setter Property="Margin" Value="0,0,2,0"/>
                        <Setter Property="Height" Value="40"/>
                        <Setter Property="Background" Value="#F8F9FA"/>
                        <Setter Property="BorderBrush" Value="#E2E8F0"/>
                        <Setter Property="BorderThickness" Value="1,1,1,0"/>
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="Foreground" Value="#64748B"/>
                        <Setter Property="MinWidth" Value="120"/>
                        <Setter Property="MaxWidth" Value="150"/>
                        <Setter Property="Width" Value="130"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TabItem">
                                    <Border x:Name="Border" 
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="8,8,0,0">
                                        <ContentPresenter x:Name="ContentSite"
                                                          VerticalAlignment="Center"
                                                          HorizontalAlignment="Center"
                                                          ContentSource="Header"
                                                          Margin="4,2"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <!-- ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ± -->
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Border" Property="Background" Value="#3B82F6"/>
                                            <Setter TargetName="Border" Property="BorderBrush" Value="#2563EB"/>
                                            <Setter Property="Foreground" Value="White"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                        </Trigger>
                                        <!-- ÿπŸÜÿØ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± -->
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Border" Property="Background" Value="#EFF6FF"/>
                                            <Setter TargetName="Border" Property="BorderBrush" Value="#3B82F6"/>
                                            <Setter Property="Foreground" Value="#1E40AF"/>
                                        </Trigger>
                                        <!-- ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ± ÿπŸÜÿØ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± -->
                                        <MultiTrigger>
                                            <MultiTrigger.Conditions>
                                                <Condition Property="IsSelected" Value="True"/>
                                                <Condition Property="IsMouseOver" Value="True"/>
                                            </MultiTrigger.Conditions>
                                            <Setter TargetName="Border" Property="Background" Value="#2563EB"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </MultiTrigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                    
                    <!-- ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ™ÿµŸÖŸäŸÖ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™ -->
                    <Style TargetType="TabControl">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TabControl">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        <!-- ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿßŸÑÿ£ŸÅŸÇŸä -->
                                        <Border Grid.Row="0" 
                                                Background="#F1F5F9" 
                                                BorderBrush="#E2E8F0" 
                                                BorderThickness="0,0,0,1"
                                                Padding="0,0,0,0">
                                            <TabPanel IsItemsHost="True" 
                                                      HorizontalAlignment="Left"
                                                      Margin="0,0,0,0"/>
                                        </Border>
                                        
                                        <!-- ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™ -->
                                        <Border Grid.Row="1" 
                                                Background="White" 
                                                BorderBrush="#E2E8F0" 
                                                BorderThickness="1,0,1,1"
                                                CornerRadius="0,0,8,8">
                                            <ContentPresenter x:Name="PART_SelectedContentHost"
                                                              Margin="0"
                                                              ContentSource="SelectedContent"/>
                                        </Border>
                                    </Grid>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TabControl.Resources>
                <!-- (1) ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE946;" FontSize="14" Margin="0,0,4,0"/>
                            <TextBlock Text="ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©" FontSize="11" FontWeight="SemiBold"/>
                        </StackPanel>
                    </TabItem.Header>

                    <Grid Margin="4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1.1*"/>
                            <ColumnDefinition Width="1.7*"/>
                            <ColumnDefinition Width="1.1*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Column="0" Margin="8">
                            <TextBlock Text="ÿßŸÑŸÉŸàÿØ" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding Model.ItemCode, UpdateSourceTrigger=PropertyChanged}" 
                                     IsReadOnly="True" Background="#F8F9FA" MinWidth="180"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="8">
                            <TextBlock Text="ÿßŸÑÿßÿ≥ŸÖ" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding Model.ItemName, UpdateSourceTrigger=PropertyChanged}" MinWidth="320"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2" Margin="8">
                            <TextBlock Text="ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding Model.ItemBarcode, UpdateSourceTrigger=PropertyChanged}" MinWidth="180"/>
                        </StackPanel>

                        <!-- ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ŸÅÿπŸäŸÑ -->
                        <StackPanel Grid.Column="3" Margin="8" Orientation="Horizontal" VerticalAlignment="Bottom">
                            <CheckBox IsChecked="{Binding Model.IsActive}" />
                            <TextBlock Margin="10,0,0,0" VerticalAlignment="Center" Text="ŸÜÿ¥ÿ∑" Foreground="#111827"/>
                        </StackPanel>

                        <!-- ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä -->
                        <StackPanel Grid.Row="1" Grid.Column="0" Margin="8">
                            <TextBlock Text="ÿßŸÑŸÅÿ¶ÿ©" Style="{StaticResource Label}"/>
                            <ComboBox ItemsSource="{Binding AllCategories}"
                                      SelectedValue="{Binding Model.CategoryID}"
                                      SelectedValuePath="CategoryID"
                                      DisplayMemberPath="CategoryName"
                                      MinWidth="180"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="1" Margin="8">
                            <TextBlock Text="ŸÜŸàÿπ ÿßŸÑÿµŸÜŸÅ" Style="{StaticResource Label}"/>
                            <ComboBox ItemsSource="{Binding AllItemTypes}"
                                      SelectedValue="{Binding Model.ItemType}"
                                      SelectedValuePath="ItemTypeCode"
                                      DisplayMemberPath="DisplayName"
                                      MinWidth="320"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="2" Margin="8">
                            <TextBlock Text="ŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ™ŸÇŸäŸäŸÖ" Style="{StaticResource Label}"/>
                            <ComboBox ItemsSource="{Binding AllValuationGroups}"
                                      SelectedValue="{Binding Model.ValuationGroup}"
                                      SelectedValuePath="ValuationGroupId"
                                      DisplayMemberPath="ValuationGroupName"
                                      MinWidth="180"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="3" Margin="8">
                            <TextBlock Text="ÿßŸÑŸàÿ≠ÿØÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©" Style="{StaticResource Label}"/>
                            <ComboBox ItemsSource="{Binding AllUnits}"
                                      SelectedValue="{Binding Model.UnitID}"
                                      SelectedValuePath="UnitID"
                                      DisplayMemberPath="UnitName"
                                      MinWidth="180"/>
                        </StackPanel>

                        <!-- ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ - ÿÆÿµÿßÿ¶ÿµ ÿßŸÑÿ™ÿ™ÿ®ÿπ -->
                        <StackPanel Grid.Row="2" Grid.Column="0" Margin="8" Orientation="Horizontal" VerticalAlignment="Bottom">
                            <CheckBox IsChecked="{Binding Model.IsBatchTracked}" />
                            <TextBlock Margin="10,0,0,0" VerticalAlignment="Center" Text="ÿ™ÿ™ÿ®ÿπ ÿØŸÅÿπÿßÿ™" Foreground="#111827"/>
                        </StackPanel>

                        <StackPanel Grid.Row="2" Grid.Column="1" Margin="8" Orientation="Horizontal" VerticalAlignment="Bottom">
                            <CheckBox IsChecked="{Binding Model.IsSerialTracked}" />
                            <TextBlock Margin="10,0,0,0" VerticalAlignment="Center" Text="ÿ™ÿ™ÿ®ÿπ ÿ≥Ÿäÿ±ŸäÿßŸÑ" Foreground="#111827"/>
                        </StackPanel>

                        <StackPanel Grid.Row="2" Grid.Column="2" Margin="8" Orientation="Horizontal" VerticalAlignment="Bottom">
                            <CheckBox IsChecked="{Binding Model.HasExpiryDate}" />
                            <TextBlock Margin="10,0,0,0" VerticalAlignment="Center" Text="ÿ™ÿßÿ±ŸäÿÆ ÿµŸÑÿßÿ≠Ÿäÿ©" Foreground="#111827"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <!-- (2) ÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸàÿ≠ÿØÿßÿ™ ŸàÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8C7;" FontSize="14" Margin="0,0,4,0"/>
                            <TextBlock Text="ÿßŸÑŸàÿ≠ÿØÿßÿ™ ŸàÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ" FontSize="11" FontWeight="SemiBold"/>
                        </StackPanel>
                    </TabItem.Header>

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition/>
                        </Grid.RowDefinitions>

                        <!-- ÿ¥ÿ±Ÿäÿ∑ ÿ•ÿ∂ÿßŸÅÿ© Ÿàÿ≠ÿØÿ© -->
                        <Border Grid.Row="0" Background="#F3F4F6" CornerRadius="10" Padding="12" Margin="0,0,0,12">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="ÿßŸÑŸàÿ≠ÿØÿ©:" VerticalAlignment="Center" Foreground="#111827" Margin="0,0,6,0"/>
                                <ComboBox Width="200" Margin="0,0,10,0"
                                          ItemsSource="{Binding AllUnits}"
                                          SelectedItem="{Binding SelectedUnitToAdd}"
                                          DisplayMemberPath="UnitName"/>
                                <TextBlock Text="ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ:" VerticalAlignment="Center" Foreground="#111827" Margin="0,0,6,0"/>
                                <TextBox Width="220" Margin="0,0,10,0"
                                         Text="{Binding UnitBarcodeToAdd, UpdateSourceTrigger=PropertyChanged}"/>
                                <Button Width="120" Padding="12,10" Command="{Binding AddUnitCommand}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE710;" FontSize="16" Margin="0,0,6,0"/>
                                        <TextBlock Text="ÿ•ÿ∂ÿßŸÅÿ©" FontSize="15"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </Border>

                        <!-- ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸàÿ≠ÿØÿßÿ™ -->
                        <DataGrid Grid.Row="1" ItemsSource="{Binding ItemUnits}" SelectedItem="{Binding SelectedItemUnit}"
                                  Style="{StaticResource ModernDataGrid}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ÿßŸÑŸàÿ≠ÿØÿ©" Binding="{Binding Unit.UnitName}" Width="150"/>
                                <DataGridTextColumn Header="ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ" Binding="{Binding UnitBarcode}" Width="220"/>
                                <DataGridTemplateColumn Header="ÿ£ÿ≥ÿßÿ≥Ÿäÿ©" Width="90">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <TextBlock Text="‚≠ê" FontSize="16" Foreground="Gold" 
                                                           Visibility="{Binding IsPrimary, Converter={StaticResource BoolToVisibility}}"
                                                           ToolTip="Ÿàÿ≠ÿØÿ© ÿ£ÿ≥ÿßÿ≥Ÿäÿ©"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridCheckBoxColumn Header="ÿ®Ÿäÿπ" Binding="{Binding IsSalesUnit}" Width="90"/>
                                <DataGridCheckBoxColumn Header="ÿ¥ÿ±ÿßÿ°" Binding="{Binding PurchaseUnit}" Width="90"/>
                                <DataGridCheckBoxColumn Header="ŸÖÿÆÿ≤ŸàŸÜ" Binding="{Binding IsInventoryUnit}" Width="90"/>
                                <DataGridTemplateColumn Header="ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™" Width="140">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <Button Width="35" Height="30" Margin="2,0"
                                                        Command="{Binding DataContext.MakePrimaryCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                        CommandParameter="{Binding}"
                                                        ToolTip="ÿ™ÿπŸäŸäŸÜ ŸÉŸàÿ≠ÿØÿ© ÿ£ÿ≥ÿßÿ≥Ÿäÿ©">
                                                    <TextBlock Text="‚≠ê" FontSize="14"/>
                                                </Button>
                                                <Button Width="35" Height="30" Margin="2,0"
                                                        Command="{Binding DataContext.RemoveUnitCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                        CommandParameter="{Binding}"
                                                        ToolTip="ÿ≠ÿ∞ŸÅ ÿßŸÑŸàÿ≠ÿØÿ©">
                                                    <TextBlock Text="üóëÔ∏è" FontSize="12"/>
                                                </Button>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>

                <!-- (3) ÿ™ÿ®ŸàŸäÿ® ÿ£ÿÆÿ±Ÿâ -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8C7;" FontSize="14" Margin="0,0,4,0"/>
                            <TextBlock Text="ÿ£ÿÆÿ±Ÿâ" FontSize="11" FontWeight="SemiBold"/>
                        </StackPanel>
                    </TabItem.Header>

                    <Grid Margin="4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1.2*"/>
                            <ColumnDefinition Width="1.2*"/>
                            <ColumnDefinition Width="1.2*"/>
                            <ColumnDefinition Width="1.2*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Column="0" Margin="8">
                            <TextBlock Text="ÿ¢ÿÆÿ± ÿ≥ÿπÿ± ÿ¥ÿ±ÿßÿ°" Style="{StaticResource Label}"/>
                            <TextBox TextAlignment="Right" Text="{Binding Model.LastPurchasePrice, StringFormat=F3}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="8">
                            <TextBlock Text="ÿßŸÑŸàÿ≤ŸÜ" Style="{StaticResource Label}"/>
                            <TextBox TextAlignment="Right" Text="{Binding Model.Weight, StringFormat=F3}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2" Margin="8">
                            <TextBlock Text="ÿßŸÑÿ≠ÿ¨ŸÖ" Style="{StaticResource Label}"/>
                            <TextBox TextAlignment="Right" Text="{Binding Model.Volume, StringFormat=F3}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="3" Margin="8">
                            <TextBlock Text="ÿ™ŸÉŸÑŸÅÿ© ŸÇŸäÿßÿ≥Ÿäÿ©" Style="{StaticResource Label}"/>
                            <TextBox TextAlignment="Right" Text="{Binding Model.StandardCost, StringFormat=F4}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="0" Margin="8">
                            <TextBlock Text="ÿ≠ÿØ ÿ£ÿØŸÜŸâ" Style="{StaticResource Label}"/>
                            <TextBox TextAlignment="Right" Text="{Binding Model.MinStockLevel, StringFormat=F0}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="1" Margin="8">
                            <TextBlock Text="ÿ≠ÿØ ÿ£ÿπŸÑŸâ" Style="{StaticResource Label}"/>
                            <TextBox TextAlignment="Right" Text="{Binding Model.MaxStockLevel, StringFormat=F0}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="2" Margin="8">
                            <TextBlock Text="ŸÜŸÇÿ∑ÿ© ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∑ŸÑÿ®" Style="{StaticResource Label}"/>
                            <TextBox TextAlignment="Right" Text="{Binding Model.ReorderLevel, StringFormat=F0}"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <!-- (4) ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8C7;" FontSize="14" Margin="0,0,4,0"/>
                            <TextBlock Text="ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ" FontSize="11" FontWeight="SemiBold"/>
                        </StackPanel>
                    </TabItem.Header>

                    <Border Margin="12" Background="White" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="12" Padding="20">
                        <Border.Effect>
                            <DropShadowEffect Color="#000000" BlurRadius="12" ShadowDepth="3" Opacity="0.08"/>
                        </Border.Effect>
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <views:ItemCostsView DataContext="{Binding ItemCostsVM}" VerticalAlignment="Top"/>
                        </ScrollViewer>
                    </Border>
                </TabItem>

                <!-- (5) ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ£ÿ≥ÿπÿßÿ± -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8C7;" FontSize="14" Margin="0,0,4,0"/>
                            <TextBlock Text="ÿßŸÑÿ£ÿ≥ÿπÿßÿ±" FontSize="11" FontWeight="SemiBold"/>
                        </StackPanel>
                    </TabItem.Header>

                    <Border Margin="12" Background="White" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="12" Padding="20">
                        <Border.Effect>
                            <DropShadowEffect Color="#000000" BlurRadius="12" ShadowDepth="3" Opacity="0.08"/>
                        </Border.Effect>
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <ContentControl Content="{Binding CurrentView}" VerticalAlignment="Top"/>
                        </ScrollViewer>
                    </Border>
                </TabItem>

                <!-- (6) ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿØŸÅÿπÿßÿ™ -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8C7;" FontSize="14" Margin="0,0,4,0"/>
                            <TextBlock Text="ÿßŸÑÿØŸÅÿπÿßÿ™" FontSize="11" FontWeight="SemiBold"/>
                        </StackPanel>
                    </TabItem.Header>

                    <Border Margin="12" Background="White" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="12" Padding="20"
                            Visibility="{Binding Model.IsBatchTracked, Converter={StaticResource BoolToVisibility}}">
                        <Border.Effect>
                            <DropShadowEffect Color="#000000" BlurRadius="12" ShadowDepth="3" Opacity="0.08"/>
                        </Border.Effect>
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <views:ItemBatchesView DataContext="{Binding ItemBatchesVM}" VerticalAlignment="Top"/>
                        </ScrollViewer>
                    </Border>
                </TabItem>

                <!-- (7) ÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8C7;" FontSize="14" Margin="0,0,4,0"/>
                            <TextBlock Text="ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™" FontSize="11" FontWeight="SemiBold"/>
                        </StackPanel>
                    </TabItem.Header>

                    <Border Margin="12" Background="White" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="12" Padding="20">
                        <Border.Effect>
                            <DropShadowEffect Color="#000000" BlurRadius="12" ShadowDepth="3" Opacity="0.08"/>
                        </Border.Effect>
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <views:ItemComponentsView DataContext="{Binding ItemComponentsVM}" VerticalAlignment="Top"/>
                        </ScrollViewer>
                    </Border>
                </TabItem>

                <!-- (8) ÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖŸàÿ±ÿØŸàŸÜ -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8C7;" FontSize="14" Margin="0,0,4,0"/>
                            <TextBlock Text="ÿßŸÑŸÖŸàÿ±ÿØŸàŸÜ" FontSize="11" FontWeight="SemiBold"/>
                        </StackPanel>
                    </TabItem.Header>

                    <Border Margin="12" Background="White" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="12" Padding="20">
                        <Border.Effect>
                            <DropShadowEffect Color="#000000" BlurRadius="12" ShadowDepth="3" Opacity="0.08"/>
                        </Border.Effect>
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <views:ItemSuppliersView DataContext="{Binding ItemSuppliersVM}" VerticalAlignment="Top"/>
                        </ScrollViewer>
                    </Border>
                </TabItem>

                <!-- (9) ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ£ÿ±ÿµÿØÿ© ÿßŸÑŸÖÿÆÿ≤ŸÜŸäÿ© -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8C7;" FontSize="14" Margin="0,0,4,0"/>
                            <TextBlock Text="ÿßŸÑÿ£ÿ±ÿµÿØÿ© ÿßŸÑŸÖÿÆÿ≤ŸÜŸäÿ©" FontSize="11" FontWeight="SemiBold"/>
                        </StackPanel>
                    </TabItem.Header>

                    <Border Margin="12" Background="White" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="12" Padding="20">
                        <Border.Effect>
                            <DropShadowEffect Color="#000000" BlurRadius="12" ShadowDepth="3" Opacity="0.08"/>
                        </Border.Effect>
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <views:InventoryBalanceView DataContext="{Binding InventoryBalanceVM}" VerticalAlignment="Top"/>
                        </ScrollViewer>
                    </Border>
                </TabItem>
            </TabControl>
            </Grid>
        </controls:Card>
    </Grid>
</ui:FluentWindow>