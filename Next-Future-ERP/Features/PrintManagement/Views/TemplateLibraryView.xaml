<Page x:Class="Next_Future_ERP.Features.PrintManagement.Views.TemplateLibraryView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:converters="clr-namespace:Next_Future_ERP.Features.PrintManagement.Converters"
      mc:Ignorable="d" 
      d:DesignHeight="800" d:DesignWidth="1200"
      Title="Ù…ÙƒØªØ¨Ø© Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©"
      FlowDirection="RightToLeft">

    <Page.Resources>
        <!-- Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª -->
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:BoolToYesNoConverter x:Key="BoolToYesNoConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!-- Ø£Ù„ÙˆØ§Ù† Ù…Ø®ØµØµØ© -->
        <SolidColorBrush x:Key="AccentBrush" Color="#2563eb"/>
        <SolidColorBrush x:Key="CardBorderBrush" Color="#e5e7eb"/>
        <SolidColorBrush x:Key="CardBackgroundBrush" Color="White"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#10b981"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#ef4444"/>
        <SolidColorBrush x:Key="WarningBrush" Color="#f59e0b"/>

        <!-- Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
        <Style x:Key="IconButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#1d4ed8"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#1e40af"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Ù†Ù…Ø· Ø§Ù„Ù†ØµÙˆØµ -->
        <Style x:Key="FormLabel" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="#374151"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Ù†Ù…Ø· ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù†Øµ -->
        <Style x:Key="FilterComboBox" TargetType="ComboBox">
            <Setter Property="BorderBrush" Value="{StaticResource CardBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ± -->
            <RowDefinition Height="Auto"/> <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª -->
            <RowDefinition Height="*"/>    <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <RowDefinition Height="Auto"/> <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© -->
        </Grid.RowDefinitions>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ± -->
        <Border Grid.Row="0" Background="{StaticResource CardBackgroundBrush}" 
                BorderBrush="{StaticResource CardBorderBrush}" 
                BorderThickness="0,0,0,1" 
                Padding="16">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ù…Ù† Ø§Ù„ÙÙ„Ø§ØªØ± -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="24"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="24"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="200"/>
                        <ColumnDefinition Width="24"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="Ø§Ù„Ø´Ø±ÙƒØ©:" Style="{StaticResource FormLabel}"/>
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding CompanyOptions}"
                              SelectedValue="{Binding SelectedCompanyId}"
                              SelectedValuePath="CompId"
                              DisplayMemberPath="CompName"
                              Style="{StaticResource FilterComboBox}"/>

                    <TextBlock Grid.Column="3" Text="Ø§Ù„ÙØ±Ø¹:" Style="{StaticResource FormLabel}"/>
                    <ComboBox Grid.Column="4"
                              ItemsSource="{Binding BranchOptions}"
                              SelectedValue="{Binding SelectedBranchId}"
                              SelectedValuePath="BranchId"
                              DisplayMemberPath="BranchName"
                              Style="{StaticResource FilterComboBox}"/>

                    <TextBlock Grid.Column="6" Text="Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯:" Style="{StaticResource FormLabel}"/>
                    <ComboBox Grid.Column="7"
                              ItemsSource="{Binding DocumentTypeOptions}"
                              SelectedValue="{Binding SelectedDocumentTypeId}"
                              SelectedValuePath="Key"
                              DisplayMemberPath="Value"
                              Style="{StaticResource FilterComboBox}"/>

                    <TextBlock Grid.Column="9" Text="Ø§Ù„Ù…Ø­Ø±Ùƒ:" Style="{StaticResource FormLabel}"/>
                    <ComboBox Grid.Column="10" 
                              SelectedValue="{Binding SelectedEngine}"
                              Style="{StaticResource FilterComboBox}">
                        <ComboBoxItem Content="Ø§Ù„ÙƒÙ„" Tag="{x:Null}"/>
                        <ComboBoxItem Content="HTML" Tag="html"/>
                        <ComboBoxItem Content="JasperReports" Tag="jrxml"/>
                        <ComboBoxItem Content="FastReport" Tag="fr3"/>
                    </ComboBox>
                </Grid>

                <!-- Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ù…Ù† Ø§Ù„ÙÙ„Ø§ØªØ± -->
                <Grid Grid.Row="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="24"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="24"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="24"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="Ø§Ù„Ù„ØºØ©:" Style="{StaticResource FormLabel}"/>
                    <ComboBox Grid.Column="1" 
                              SelectedValue="{Binding SelectedLocale}"
                              Style="{StaticResource FilterComboBox}">
                        <ComboBoxItem Content="Ø§Ù„ÙƒÙ„" Tag="{x:Null}"/>
                        <ComboBoxItem Content="Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" Tag="ar-SA"/>
                        <ComboBoxItem Content="Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©" Tag="en"/>
                    </ComboBox>

                    <TextBlock Grid.Column="3" Text="Ø§Ù„Ø­Ø§Ù„Ø©:" Style="{StaticResource FormLabel}"/>
                    <ComboBox Grid.Column="4" 
                              SelectedValue="{Binding FilterActive}"
                              Style="{StaticResource FilterComboBox}">
                        <ComboBoxItem Content="Ø§Ù„ÙƒÙ„" Tag="{x:Null}"/>
                        <ComboBoxItem Content="Ù†Ø´Ø·" Tag="True"/>
                        <ComboBoxItem Content="Ù…Ø¹Ø·Ù„" Tag="False"/>
                    </ComboBox>

                    <TextBlock Grid.Column="6" Text="Ø§ÙØªØ±Ø§Ø¶ÙŠ:" Style="{StaticResource FormLabel}"/>
                    <ComboBox Grid.Column="7" 
                              SelectedValue="{Binding FilterDefault}"
                              Style="{StaticResource FilterComboBox}">
                        <ComboBoxItem Content="Ø§Ù„ÙƒÙ„" Tag="{x:Null}"/>
                        <ComboBoxItem Content="Ø§ÙØªØ±Ø§Ø¶ÙŠ" Tag="True"/>
                        <ComboBoxItem Content="Ø¹Ø§Ø¯ÙŠ" Tag="False"/>
                    </ComboBox>

                    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø­Ø« -->
                    <StackPanel Grid.Column="9" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Ø¨Ø­Ø«" Style="{StaticResource IconButton}" Command="{Binding SearchAsyncCommand}"/>
                        <Button Content="ØªØµÙÙŠØ±" Background="{StaticResource WarningBrush}" Style="{StaticResource IconButton}" Command="{Binding ClearFiltersAsyncCommand}"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª -->
        <Border Grid.Row="1" Background="{StaticResource CardBackgroundBrush}" 
                BorderBrush="{StaticResource CardBorderBrush}" 
                BorderThickness="0,0,0,1" 
                Padding="16,12">
            <StackPanel Orientation="Horizontal">
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… -->
                <Button Content="ðŸ”§ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…" Style="{StaticResource IconButton}" Background="#8b5cf6" Click="InitializeSystemButton_Click"/>
                <Button Content="ðŸ“Š ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…" Style="{StaticResource IconButton}" Background="#06b6d4" Click="CheckSystemButton_Click"/>
                
                <Rectangle Width="1" Height="24" Fill="{StaticResource CardBorderBrush}" Margin="12,0"/>
                
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ -->
                <Button Content="ðŸ“ Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯" Style="{StaticResource IconButton}" Click="CreateNewTemplateButton_Click"/>
                <Button Content="ðŸ“‹ Ù†Ø³Ø®" Background="{StaticResource SuccessBrush}" Style="{StaticResource IconButton}" Command="{Binding DuplicateTemplateAsyncCommand}"/>
                <Button Content="â­ ØªØ¹ÙŠÙŠÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠ" Background="{StaticResource WarningBrush}" Style="{StaticResource IconButton}" Command="{Binding SetDefaultAsyncCommand}"/>
                <Button Content="ðŸ”„ ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù" Background="#6b7280" Style="{StaticResource IconButton}" Command="{Binding ToggleActiveAsyncCommand}"/>
                
                <Rectangle Width="1" Height="24" Fill="{StaticResource CardBorderBrush}" Margin="12,0"/>
                
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ -->
                <Button Content="ðŸ¢ ÙØªØ­ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„" Background="#059669" Style="{StaticResource IconButton}" Click="OpenWorkspaceButton_Click"/>
                <Button Content="ðŸ”„ ØªØ­Ø¯ÙŠØ«" Background="#6366f1" Style="{StaticResource IconButton}" Command="{Binding RefreshAsyncCommand}"/>
            </StackPanel>
        </Border>

        <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <DataGrid Grid.Row="2" 
                  ItemsSource="{Binding Templates}"
                  SelectedItem="{Binding SelectedTemplate}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  GridLinesVisibility="Horizontal"
                  HeadersVisibility="Column"
                  SelectionMode="Single"
                  SelectionUnit="FullRow"
                  Background="White"
                  BorderBrush="{StaticResource CardBorderBrush}"
                  BorderThickness="1,0,1,1"
                  AlternatingRowBackground="#f9fafb">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨" Binding="{Binding Name}" Width="200"/>
                <DataGridTextColumn Header="Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯" Binding="{Binding DocumentTypeName}" Width="150"/>
                <DataGridTextColumn Header="Ø§Ù„Ø´Ø±ÙƒØ©" Binding="{Binding CompanyName}" Width="120"/>
                <DataGridTextColumn Header="Ø§Ù„ÙØ±Ø¹" Binding="{Binding BranchName}" Width="100"/>
                <DataGridTextColumn Header="Ø§Ù„Ù…Ø­Ø±Ùƒ" Binding="{Binding Engine}" Width="80"/>
                <DataGridTextColumn Header="Ø§Ù„Ù„ØºØ©" Binding="{Binding Locale}" Width="80"/>
                <DataGridTextColumn Header="Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ø´Ø·" Binding="{Binding ActiveVersionNo}" Width="100"/>
                
                <DataGridTemplateColumn Header="Ø§ÙØªØ±Ø§Ø¶ÙŠ" Width="80">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Border Background="{Binding IsDefault, Converter={StaticResource BoolToColorConverter}}" 
                                    CornerRadius="3" Padding="6,2" HorizontalAlignment="Center">
                                <TextBlock Text="{Binding IsDefault, Converter={StaticResource BoolToYesNoConverter}}" 
                                           Foreground="White" FontSize="11" FontWeight="Bold"/>
                            </Border>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTemplateColumn Header="Ø§Ù„Ø­Ø§Ù„Ø©" Width="80">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Border Background="{Binding Active, Converter={StaticResource BoolToColorConverter}}" 
                                    CornerRadius="3" Padding="6,2" HorizontalAlignment="Center">
                                <TextBlock Text="{Binding Status}" 
                                           Foreground="White" FontSize="11" FontWeight="Bold"/>
                            </Border>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="Ø¢Ø®Ø± ØªÙØ¹ÙŠÙ„" Binding="{Binding LastActivatedAt, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" Width="120"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© -->
        <Border Grid.Row="3" Background="#f3f4f6" 
                BorderBrush="{StaticResource CardBorderBrush}" 
                BorderThickness="1,1,1,0" 
                Padding="16,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="{Binding StatusMessage}" 
                           Style="{StaticResource FormLabel}"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock Text="{Binding TemplateStats[Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹], StringFormat='Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: {0}'}" 
                               Style="{StaticResource FormLabel}" Margin="0,0,16,0"/>
                    <TextBlock Text="{Binding TemplateStats[Ø§Ù„Ù†Ø´Ø·Ø©], StringFormat='Ø§Ù„Ù†Ø´Ø·Ø©: {0}'}" 
                               Style="{StaticResource FormLabel}" Margin="0,0,16,0"/>
                    <TextBlock Text="{Binding TemplateStats[Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©], StringFormat='Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: {0}'}" 
                               Style="{StaticResource FormLabel}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
        <Grid Grid.RowSpan="4" Background="#80000000" Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border Background="White" CornerRadius="8" Padding="32" HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel>
                    <ProgressBar IsIndeterminate="True" Height="4" Margin="0,0,0,16"/>
                    <TextBlock Text="Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..." HorizontalAlignment="Center" FontSize="14" FontWeight="Medium"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Page>
