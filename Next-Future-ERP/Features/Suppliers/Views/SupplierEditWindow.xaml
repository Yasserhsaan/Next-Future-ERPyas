<ui:FluentWindow
    x:Class="Next_Future_ERP.Features.Suppliers.Views.SupplierEditWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:controls="clr-namespace:Wpf.Ui.Controls;assembly=Wpf.Ui"
    mc:Ignorable="d"
    Title="مورد"
    Height="560" Width="980"
    FlowDirection="RightToLeft"
    WindowStartupLocation="CenterOwner"
    ResizeMode="CanResizeWithGrip"
    UseLayoutRounding="True"
    SnapsToDevicePixels="True"
    FontSize="14">

    <!-- موارد بسيطة وآمنة -->
    <ui:FluentWindow.Resources>
        <Style TargetType="TextBlock" x:Key="Label">
            <Setter Property="Foreground" Value="#64748B"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>

        <!-- أيقونات MDL2 -->
        <Style x:Key="IconText" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Margin" Value="0,0,6,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </ui:FluentWindow.Resources>

    <Grid Margin="14">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
        </Grid.RowDefinitions>

        <ui:TitleBar
            x:Name="TitleBar"
            Title="بيانات المورد"
            Grid.Row="0"
            CloseWindowByDoubleClickOnIcon="True" />

        <!-- شريط علوي -->
        <controls:Card Grid.Row="1" Padding="12" Margin="0,0,0,12">
            <DockPanel LastChildFill="False">
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                    <Button Padding="14,10" Command="{Binding SaveCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource IconText}" Text="&#xE74E;"/>
                            <!-- Save -->
                            <TextBlock Text="حفظ" FontSize="15"/>
                        </StackPanel>
                    </Button>
                    <Button Padding="14,10" Margin="10,0,0,0" Command="{Binding CancelCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource IconText}" Text="&#xE711;"/>
                            <!-- Cancel -->
                            <TextBlock Text="إلغاء" FontSize="15"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <TextBlock VerticalAlignment="Center" FontWeight="SemiBold" Foreground="#111827" FontSize="18">
                    تحرير بيانات المورد
                </TextBlock>
            </DockPanel>
        </controls:Card>

        <!-- المحتوى: تبويب واحد بعرض الصفحة -->
        <controls:Card Grid.Row="2" Padding="16">
            <TabControl FontSize="14">
                <!-- (1) تبويب بيانات المورد -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE946;" FontSize="16" Margin="0,0,6,0"/>
                            <TextBlock Text="بيانات المورد" FontSize="15"/>
                        </StackPanel>
                    </TabItem.Header>

                    <Grid Margin="4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1.1*"/>
                            <ColumnDefinition Width="1.7*"/>
                            <!-- الاسم أوسع -->
                            <ColumnDefinition Width="1.1*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Column="0" Margin="8">
                            <TextBlock Text="الكود" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding Model.SupplierCode, UpdateSourceTrigger=PropertyChanged}" MinWidth="180"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="8">
                            <TextBlock Text="الاسم" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding Model.SupplierName, UpdateSourceTrigger=PropertyChanged}" MinWidth="320"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2" Margin="8">
                            <TextBlock Text="الرقم الضريبي" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding Model.TaxNumber, UpdateSourceTrigger=PropertyChanged}" MinWidth="180"/>
                        </StackPanel>

                        <!-- حالة التفعيل والقائمة السوداء -->
                        <StackPanel Grid.Column="3" Margin="8" VerticalAlignment="Bottom">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <CheckBox IsChecked="{Binding Model.IsActive}" />
                                <TextBlock Margin="10,0,0,0" VerticalAlignment="Center" Text="نشط" Foreground="#111827"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <CheckBox IsChecked="{Binding Model.IsBlacklisted}" />
                                <TextBlock Margin="10,0,0,0" VerticalAlignment="Center" Text="القائمة السوداء" Foreground="#DC2626"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- مجموعة داخلية: بيانات الدفع -->
                        <Border Grid.ColumnSpan="4" Grid.Row="2" Margin="8,16,8,0" Padding="12"
                        Background="#F9FAFB" BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="10">
                            <StackPanel>
                                <TextBlock Text="بيانات الدفع" FontWeight="SemiBold" Foreground="#111827" Margin="0,0,0,8"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="1.3*"/>
                                        <ColumnDefinition Width="1.3*"/>
                                        <ColumnDefinition Width="1.3*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Margin="8,0,8,0">
                                        <TextBlock Text="الحساب" Style="{StaticResource Label}"/>
                                        <ComboBox ItemsSource="{Binding AccountOptions}"
                                          SelectedValue="{Binding Model.AccountID}"
                                          SelectedValuePath="AccountId"
                                          DisplayMemberPath="AccountDisplay"
                                          MinWidth="230"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Margin="8,0,8,0">
                                        <TextBlock Text="مركز التكلفة" Style="{StaticResource Label}"/>
                                        <TextBox Text="{Binding Model.CostCenterID}" MinWidth="210"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="2" Margin="8,0,8,0">
                                        <TextBlock Text="شرط الدفع" Style="{StaticResource Label}"/>
                                        <ComboBox ItemsSource="{Binding AllTerms}"
                                          SelectedValue="{Binding Model.PaymentTerms}"
                                          SelectedValuePath="TermId"
                                          DisplayMemberPath="TermName"
                                          MinWidth="230"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="3" Margin="8,0,8,0">
                                        <TextBlock Text="الحد الائتماني" Style="{StaticResource Label}"/>
                                        <TextBox Text="{Binding Model.CreditLimit}" MinWidth="190"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- (2) تبويب بيانات التواصل -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE717;" FontSize="16" Margin="0,0,6,0"/>
                            <TextBlock Text="بيانات التواصل" FontSize="15"/>
                        </StackPanel>
                    </TabItem.Header>

                    <Grid Margin="4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1.3*"/>
                            <ColumnDefinition Width="1.3*"/>
                            <ColumnDefinition Width="1.3*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Column="0" Margin="8">
                            <TextBlock Text="الشخص المسؤول" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding Model.ContactPerson}" MinWidth="230"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="8">
                            <TextBlock Text="الهاتف" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding Model.Phone}" MinWidth="210"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2" Margin="8">
                            <TextBlock Text="البريد الإلكتروني" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding Model.Email}" MinWidth="230"/>
                        </StackPanel>

                        <StackPanel Grid.ColumnSpan="4" Grid.Row="1" Margin="8">
                            <TextBlock Text="العنوان" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding Model.Address}" MinWidth="420"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <!-- (3) تبويب طرق الدفع -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8C7;" FontSize="16" Margin="0,0,6,0"/>
                            <TextBlock Text="طرق الدفع" FontSize="15"/>
                        </StackPanel>
                    </TabItem.Header>

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- شريط إضافة -->
                        <Border Grid.Row="0" Background="#F3F4F6" CornerRadius="10" Padding="12" Margin="0,0,0,12">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Width="150" Padding="12,10" Command="{Binding AddMethodCommand}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE710;" FontSize="16" Margin="0,0,6,0"/>
                                        <!-- Add -->
                                        <TextBlock Text="إضافة" FontSize="15"/>
                                    </StackPanel>
                                </Button>

                                <ComboBox Width="260" Margin="10,0,0,0"
                                  ItemsSource="{Binding AllMethods}"
                                  SelectedItem="{Binding SelectedMethodToAdd}"
                                  DisplayMemberPath="MethodName"
                                  FontSize="14"/>
                            </StackPanel>
                        </Border>

                        <!-- القائمة -->
                        <ListView Grid.Row="1"
                          Margin="0,0,0,12"
                          ItemsSource="{Binding SupplierMethods}"
                          SelectedItem="{Binding SelectedSupplierMethod}"
                          BorderThickness="0"
                          FontSize="14">
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="Margin" Value="0,0,0,10"/>
                                    <Setter Property="Padding" Value="0"/>
                                </Style>
                            </ListView.ItemContainerStyle>
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="White" BorderBrush="#E6EAF0"
                                    BorderThickness="1" CornerRadius="12" Padding="12">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition/>
                                                <ColumnDefinition Width="220"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Text="{Binding Method.MethodName}"
                                               FontWeight="SemiBold" Foreground="#111827" FontSize="15"/>
                                            <TextBlock Grid.Column="1"
                                               Text="{Binding Method.GLAccount}"
                                               Foreground="#6B7280" />

                                            <Border Grid.Column="2" Margin="10,0,0,0"
                                            Background="#ECFDF5" BorderBrush="#A7F3D0"
                                            BorderThickness="1" CornerRadius="10" Padding="8,2"
                                            Visibility="{Binding Is_Default, Converter={StaticResource BoolToVisibility}}">
                                                <TextBlock Text="افتراضي" Foreground="#065F46" FontWeight="SemiBold"/>
                                            </Border>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <!-- أزرار إجراءات -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal">
                            <Button Width="170" Padding="12,10" Command="{Binding MakeDefaultCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE734;" FontSize="16" Margin="0,0,6,0"/>
                                    <!-- Star -->
                                    <TextBlock Text="تعيين افتراضي" FontSize="15"/>
                                </StackPanel>
                            </Button>

                            <Button Width="140" Padding="12,10" Margin="10,0,0,0" Command="{Binding RemoveMethodCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74D;" FontSize="16" Margin="0,0,6,0"/>
                                    <!-- Delete -->
                                    <TextBlock Text="حذف" FontSize="15"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Grid>
                </TabItem>
            </TabControl>
        </controls:Card>
    </Grid>
</ui:FluentWindow>
