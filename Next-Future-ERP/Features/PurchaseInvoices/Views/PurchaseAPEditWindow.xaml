<Window x:Class="Next_Future_ERP.Features.PurchaseInvoices.Views.PurchaseAPEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:helpers="clr-namespace:Next_Future_ERP.Features.PurchaseInvoices.Converters"
        Title="{Binding WindowTitle}"
        Height="680" Width="1120"
        MinWidth="980" MinHeight="600"
        FlowDirection="RightToLeft"
        WindowStartupLocation="CenterOwner"
        Background="#F6F7F9"
        ResizeMode="CanResizeWithGrip">

    <!-- Ø§Ø®ØªØµØ§Ø±Ø§Øª -->
    <Window.InputBindings>
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SaveCommand}"/>
        <KeyBinding Key="Escape" Command="{Binding CancelCommand}"/>
    </Window.InputBindings>

    <!-- Ù…ÙˆØ§Ø±Ø¯ / Ø«ÙŠÙ… -->
    <Window.Resources>
        <!-- Converters -->
        <helpers:InverseBooleanConverter x:Key="InverseBoolConverter"/>
        <helpers:ItemIdToNameConverter x:Key="ItemIdToName"/>
        <helpers:UnitIdToNameConverter x:Key="UnitIdToName"/>
        <helpers:WarehouseIdToNameConverter x:Key="WarehouseIdToName"/>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <!-- Ø£Ù„ÙˆØ§Ù† -->
        <SolidColorBrush x:Key="Clr.Surface" Color="#FFFFFFFF"/>
        <SolidColorBrush x:Key="Clr.SurfaceAlt" Color="#FAFBFD"/>
        <SolidColorBrush x:Key="Clr.Border" Color="#E6EAF0"/>
        <SolidColorBrush x:Key="Clr.BorderStrong" Color="#D5DAE2"/>
        <SolidColorBrush x:Key="Clr.Muted" Color="#6B7280"/>
        <SolidColorBrush x:Key="Clr.Primary" Color="#0A6ED1"/>
        <SolidColorBrush x:Key="Clr.PrimaryDark" Color="#0854A0"/>
        <SolidColorBrush x:Key="Clr.Success" Color="#0E9F6E"/>
        <SolidColorBrush x:Key="Clr.Danger" Color="#DC2626"/>
        <SolidColorBrush x:Key="Clr.TableHeader" Color="#F2F5F9"/>

        <!-- Ø¸Ù„Ø§Ù„ -->
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource Clr.Surface}"/>
            <Setter Property="CornerRadius" Value="14"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#1F000000" BlurRadius="10" ShadowDepth="1" Opacity="0.25"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Ù†ØµÙˆØµ -->
        <Style x:Key="SectionTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#111827"/>
        </Style>
        <Style x:Key="Caption" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource Clr.Muted}"/>
        </Style>

        <!-- Ù…Ø¯Ø®Ù„Ø§Øª -->
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Margin" Value="0,4,0,0"/>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Margin" Value="0,4,0,0"/>
            <Setter Property="IsEditable" Value="False"/>
        </Style>
        <Style TargetType="DatePicker">
            <Setter Property="Margin" Value="0,4,0,0"/>
        </Style>

        <!-- Ø£Ø²Ø±Ø§Ø± -->
        <Style x:Key="Btn.Primary" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource Clr.Primary}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.PrimaryDark}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>
        <Style x:Key="Btn.Secondary" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource Clr.SurfaceAlt}"/>
            <Setter Property="Foreground" Value="#111827"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="MinWidth" Value="110"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.BorderStrong}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style x:Key="Btn.Ghost" TargetType="Button" BasedOn="{StaticResource Btn.Secondary}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
        </Style>

        <!-- Ø¨Ø¯Ø§Ø¦Ù„ Spacing -->
        <Style x:Key="HStackChildren10" TargetType="FrameworkElement">
            <Setter Property="Margin" Value="0,0,10,0"/>
        </Style>
        <Style x:Key="HStackChildren8" TargetType="FrameworkElement">
            <Setter Property="Margin" Value="0,0,8,0"/>
        </Style>
        
        <!-- DataGrid -->
        <Style TargetType="DataGrid">
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="RowHeight" Value="34"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="AlternationCount" Value="2"/>
            <Setter Property="AlternatingRowBackground" Value="#FBFCFE"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
            <Setter Property="SelectionMode" Value="Single"/>
        </Style>
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="{StaticResource Clr.TableHeader}"/>
            <Setter Property="Foreground" Value="#374151"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
        </Style>
        <Style TargetType="DataGridRow">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
        </Style>
        <Style TargetType="DataGridCell">
            <Setter Property="BorderBrush" Value="{StaticResource Clr.Border}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="8,4"/>
        </Style>

        <!-- Ø§Ø®ØªÙŠØ§Ø± -->
        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#D6E6FB"/>
        <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="#D6E6FB"/>

        <!-- ===================== ØªØµÙ…ÙŠÙ… Ø§Ù„Ø­Ø§Ù„Ø©: Ø´Ø§Ø±Ø© + Stepper ===================== -->
        <!-- Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <Style x:Key="StatusBadge" TargetType="Border">
            <Setter Property="CornerRadius" Value="20"/>
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="#F1F5F9"/>
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
        </Style>

        <!-- ListBox ÙƒÙ€ Stepper Ø£ÙÙ‚ÙŠ -->
        <Style x:Key="StatusStepperListBox" TargetType="ListBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Ø¹Ù†ØµØ± Ø§Ù„Ù€ Stepper -->
        <Style x:Key="StatusStepperItem" TargetType="ListBoxItem">
            <Setter Property="Margin" Value="0,0,28,0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Foreground" Value="#111827"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="36"/>
                            </Grid.ColumnDefinitions>

                            <!-- Ø¯Ø§Ø¦Ø±Ø© + Ù†Øµ -->
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <Grid Width="28" Height="28">
                                    <Ellipse x:Name="Circle"
                                             Stroke="{StaticResource Clr.BorderStrong}"
                                             Fill="{StaticResource Clr.Surface}"
                                             StrokeThickness="1.2"/>
                                    <TextBlock x:Name="Idx"
                                               Text="{TemplateBinding Tag}"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               FontSize="12" FontWeight="SemiBold"
                                               Foreground="#374151"/>
                                </Grid>
                                <TextBlock x:Name="Lbl"
                                           Margin="8,0,0,0" VerticalAlignment="Center"
                                           FontSize="13" Text="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=Content}"/>
                            </StackPanel>

                            <!-- Ø®Ø· Ø§Ù„ÙˆØµÙ„ -->
                            <Border x:Name="Connector"
                                    Grid.Column="1"
                                    Height="2"
                                    VerticalAlignment="Center"
                                    Background="{StaticResource Clr.BorderStrong}"/>

                        </Grid>

                        <!-- Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ -->
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Circle" Property="Fill" Value="{StaticResource Clr.Primary}"/>
                                <Setter TargetName="Circle" Property="Stroke" Value="{StaticResource Clr.PrimaryDark}"/>
                                <Setter TargetName="Idx" Property="Foreground" Value="White"/>
                                <Setter TargetName="Lbl" Property="Foreground" Value="{StaticResource Clr.Primary}"/>
                                <Setter TargetName="Lbl" Property="FontWeight" Value="SemiBold"/>
                                <Setter TargetName="Connector" Property="Background" Value="{StaticResource Clr.Primary}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Circle" Property="Stroke" Value="{StaticResource Clr.Primary}"/>
                                <Setter TargetName="Lbl" Property="Foreground" Value="{StaticResource Clr.Primary}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Ù†Ù…Ø· ÙŠØ®ÙÙÙŠ Ø®Ø· Ø§Ù„ÙˆØµÙ„ Ù„Ø¢Ø®Ø± Ø¹Ù†ØµØ± -->
        <Style x:Key="StatusStepperListBox.WithHideLast" TargetType="ListBox" BasedOn="{StaticResource StatusStepperListBox}">
            <Setter Property="AlternationCount" Value="1000"/>
            <Setter Property="ItemContainerStyle" Value="{StaticResource StatusStepperItem}"/>
            <Style.Triggers>
                <!-- Ù„Ø§ Ø´ÙŠØ¡ Ù‡Ù†Ø§Ø› Ø§Ù„Ø¥Ø®ÙØ§Ø¡ Ø³ÙŠØªÙ… Ø¹Ø¨Ø± Trigger Ù„ÙƒÙ„ Ø¹Ù†ØµØ± -->
            </Style.Triggers>
        </Style>
        
        <!-- Ø¹Ù†ØµØ± Ù…Ø®ØµØµ Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙˆØµÙ„Ø© ÙÙŠ Ø¢Ø®Ø± Ø¹Ù†ØµØ± Ø¹Ø¨Ø± Attached Behavior Ø¨Ø³ÙŠØ· XAML-only -->
        <Style TargetType="ListBoxItem" BasedOn="{StaticResource StatusStepperItem}">
            <Style.Triggers>
                <!-- Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø£Ø®ÙŠØ± -->
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=(ItemsControl.AlternationIndex)}" Value="0">
                    <!-- placeholder (Ù†ÙØ¨Ù‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ§ÙÙ‚) -->
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <!-- ØªÙ„ÙˆÙŠÙ† Ø¥Ø¶Ø§ÙÙŠ Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ù…Ù†Ø·Ù‚) -->
        <Style x:Key="StatusBadgeDynamic" TargetType="Border" BasedOn="{StaticResource StatusBadge}">
            <Style.Triggers>
                <!-- Ù…Ø³ÙˆØ¯Ø© -->
                <DataTrigger Binding="{Binding PurchaseAP.Status}" Value="0">
                    <Setter Property="Background" Value="#F3F4F6"/>
                    <Setter Property="BorderBrush" Value="#E5E7EB"/>
                </DataTrigger>
                <!-- Ù…Ø­ÙÙˆØ¸ -->
                <DataTrigger Binding="{Binding PurchaseAP.Status}" Value="1">
                    <Setter Property="Background" Value="#EFF6FF"/>
                    <Setter Property="BorderBrush" Value="#BFDBFE"/>
                </DataTrigger>
                <!-- Ù…Ø±Ø­Ù„ -->
                <DataTrigger Binding="{Binding PurchaseAP.Status}" Value="2">
                    <Setter Property="Background" Value="#ECFDF5"/>
                    <Setter Property="BorderBrush" Value="#A7F3D0"/>
                </DataTrigger>
                <!-- Ù…Ù„ØºÙŠ -->
                <DataTrigger Binding="{Binding PurchaseAP.Status}" Value="9">
                    <Setter Property="Background" Value="#FEF2F2"/>
                    <Setter Property="BorderBrush" Value="#FECACA"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <!-- ===================== /ØªØµÙ…ÙŠÙ… Ø§Ù„Ø­Ø§Ù„Ø© ===================== -->
    </Window.Resources>

    <!-- ØªØ®Ø·ÙŠØ· Ø¹Ø§Ù… -->
    <DockPanel LastChildFill="True">

        <!-- Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ -->
        <Border Background="White" DockPanel.Dock="Top" BorderBrush="{StaticResource Clr.Border}" BorderThickness="0,0,0,1" Padding="12,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Ø¹Ù†ÙˆØ§Ù† + Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯ + Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <StackPanel.Resources>
                        <Style TargetType="FrameworkElement" BasedOn="{StaticResource HStackChildren10}"/>
                    </StackPanel.Resources>

                    <TextBlock Text="{Binding WindowTitle}" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>

                    <Border CornerRadius="12" Padding="8,3" Background="#F1F5F9" BorderBrush="#E5E7EB" BorderThickness="1" VerticalAlignment="Center">
                        <TextBlock Text="{Binding PurchaseAP.DocNumber}" FontSize="12" Foreground="#374151"/>
                    </Border>

                    <!-- Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© -->
                    <Border Style="{StaticResource StatusBadgeDynamic}" VerticalAlignment="Center">
                        <TextBlock FontSize="12" FontWeight="SemiBold" Text="{Binding PurchaseAP.StatusText}"/>
                    </Border>
                </StackPanel>

                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                    <StackPanel.Resources>
                        <Style TargetType="FrameworkElement" BasedOn="{StaticResource HStackChildren8}"/>
                    </StackPanel.Resources>

                    <Button Content="Ø­ÙØ¸" Command="{Binding SaveCommand}" Style="{StaticResource Btn.Primary}"/>
                    <Button Content="Ø¥Ù„ØºØ§Ø¡" Command="{Binding CancelCommand}" Style="{StaticResource Btn.Secondary}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Ù…Ø­ØªÙˆÙ‰ -->
        <ScrollViewer Padding="16">
            <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
                    <RowDefinition Height="14"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

                <!-- Ø¨Ø·Ø§Ù‚Ø©: Ø§Ù„Ù‡ÙŠØ¯Ø± -->
                <Border Grid.Row="0" Style="{StaticResource Card}">
                    <Grid Margin="4">
                <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1.1*"/>
                            <ColumnDefinition Width="1.1*"/>
                            <ColumnDefinition Width="1.1*"/>
                            <ColumnDefinition Width="1.1*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                        <!-- Ø«Ù„Ø§Ø«Ø© ØµÙÙˆÙ: Ø¹Ù†ÙˆØ§Ù† / Ø­Ù‚ÙˆÙ„ / Ø­Ø§Ù„Ø©+Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                        <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù… -->
                        <Grid Grid.Row="0" Grid.ColumnSpan="5" Margin="0,0,0,8">
                            <TextBlock Text="Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©" Style="{StaticResource SectionTitle}"/>
                        </Grid>

                        <!-- ØµÙ Ø§Ù„Ø­Ù‚ÙˆÙ„ -->
                        <!-- Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯ -->
                        <StackPanel Grid.Row="1" Grid.Column="0" Margin="8">
                            <TextBlock Text="Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯" Style="{StaticResource Caption}"/>
                            <TextBox Text="{Binding PurchaseAP.DocNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True"/>
                </StackPanel>

                        <!-- Ø§Ù„ØªØ§Ø±ÙŠØ® -->
                        <StackPanel Grid.Row="1" Grid.Column="1" Margin="8">
                            <TextBlock Text="Ø§Ù„ØªØ§Ø±ÙŠØ®" Style="{StaticResource Caption}"/>
                            <DatePicker SelectedDate="{Binding PurchaseAP.DocDate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                        <!-- Ø§Ù„Ù…ÙˆØ±Ù‘Ø¯ -->
                        <StackPanel Grid.Row="1" Grid.Column="2" Margin="8">
                            <TextBlock Text="Ø§Ù„Ù…ÙˆØ±Ù‘Ø¯" Style="{StaticResource Caption}"/>
                    <ComboBox ItemsSource="{Binding Suppliers}"
                              SelectedValue="{Binding PurchaseAP.SupplierId}"
                              SelectedValuePath="SupplierID"
                              DisplayMemberPath="SupplierName"
                              IsEnabled="False"
                              Background="LightGray"
                              ToolTip="ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù…ÙˆØ±Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø³Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±"/>
                </StackPanel>

                        <!-- Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ -->
                        <StackPanel Grid.Row="1" Grid.Column="3" Margin="8">
                            <TextBlock Text="Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹" Style="{StaticResource Caption}"/>
                            <TextBox Text="{Binding PurchaseAP.ReferenceNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                        <!-- Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù -->
                        <StackPanel Grid.Row="1" Grid.Column="4" Margin="8">
                            <TextBlock Text="Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù" Style="{StaticResource Caption}"/>
                            <TextBox Text="{Binding PurchaseAP.ExchangeRate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                        <!-- Ø§Ù„Ø­Ø§Ù„Ø©: Stepper Ø£ÙÙ‚ÙŠ ÙŠØ´Ø¨Ù‡ SAP ByDesign -->
                        <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="5" Margin="8,12,8,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Text="Ø§Ù„Ø­Ø§Ù„Ø©" Style="{StaticResource Caption}" Margin="0,0,0,4"/>
                                
                                <ListBox Grid.Column="1"
                                    Style="{StaticResource StatusStepperListBox.WithHideLast}"
                                    ItemContainerStyle="{StaticResource StatusStepperItem}"
                                    SelectedValuePath="Tag"
                                    SelectedValue="{Binding PurchaseAP.Status, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                    <!-- ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© ÙŠØ£ØªÙŠ Ù…Ù† TagØŒ ÙˆØ§Ù„Ù†Øµ Ù…Ù† Content -->
                                    <ListBoxItem Content="Ù…Ø³ÙˆØ¯Ø©" Tag="0"/>
                                    <ListBoxItem Content="Ù…Ø­ÙÙˆØ¸" Tag="1"/>
                                    <ListBoxItem Content="Ù…Ø±Ø­Ù„" Tag="2"/>
                                    <ListBoxItem Content="Ù…Ù„ØºÙŠ" Tag="9"/>
                                </ListBox>
                                
                                <!-- Ø²Ø± Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø³Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… -->
                                <Button Grid.Column="2" 
                                        Content="Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø³Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…" 
                                        Command="{Binding LoadFromStoreReceiptCommand}" 
                                        Style="{StaticResource Btn.Ghost}"
                                        Margin="20,0,0,0"
                                        VerticalAlignment="Center"/>
                            </Grid>
                </StackPanel>

                        <!-- Ø§Ù„ÙˆØµÙ -->
                        <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="5" Margin="8,56,8,0">
                            <TextBlock Text="Ø§Ù„ÙˆØµÙ" Style="{StaticResource Caption}"/>
                            <TextBox Text="{Binding PurchaseAP.Remarks, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     AcceptsReturn="True" Height="32" TextWrapping="Wrap"/>
                </StackPanel>
            </Grid>
        </Border>


                <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
                <Border Grid.Row="2" Style="{StaticResource Card}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Ø¹Ù†ÙˆØ§Ù† -->
                        <TextBlock Text="ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©" Style="{StaticResource SectionTitle}" Margin="0,0,0,4"/>

                        <!-- Ù…Ù„Ø§Ø­Ø¸Ø© -->
                        <TextBlock Grid.Row="0" Text="(ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø³Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… - Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)" 
                                   FontStyle="Italic" Foreground="{StaticResource Clr.Muted}" 
                                   Margin="0,32,0,0" VerticalAlignment="Center"/>

                        <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
                        <DataGrid x:Name="DetailsGrid"
                                  Grid.Row="2"
                                  ItemsSource="{Binding Details}"
                          SelectedItem="{Binding SelectedDetail}"
                                  AlternatingRowBackground="#F8FAFF"
                          IsReadOnly="True"
                          Background="LightGray"
                                  Loaded="DetailsGrid_Loaded">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Ø±Ù‚Ù… Ø§Ù„Ø³Ø·Ø±" Binding="{Binding LineNo}" Width="80" IsReadOnly="True"/>
                                <DataGridTemplateColumn Header="Ø§Ù„ØµÙ†Ù" Width="200">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock>
                                                <TextBlock.Text>
                                                    <MultiBinding Converter="{StaticResource ItemIdToName}">
                                                        <Binding Path="ItemId"/>
                                                        <Binding Path="DataContext.Items" RelativeSource="{RelativeSource AncestorType=Window}"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="Ø§Ù„ÙˆØ­Ø¯Ø©" Width="100">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock>
                                                <TextBlock.Text>
                                                    <MultiBinding Converter="{StaticResource UnitIdToName}">
                                                        <Binding Path="UnitId"/>
                                                        <Binding Path="DataContext.Units" RelativeSource="{RelativeSource AncestorType=Window}"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Ø§Ù„ÙƒÙ…ÙŠØ©" Binding="{Binding Quantity, StringFormat=\{0:N3\}}" Width="100" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©" Binding="{Binding UnitPrice, StringFormat=\{0:N3\}}" Width="100" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ" Binding="{Binding TaxableAmount, StringFormat=\{0:N2\}}" Width="120" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©" Binding="{Binding VATRate, StringFormat=\{0:N2\}}" Width="100" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Ù…Ø¨Ù„Øº Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©" Binding="{Binding VATAmount, StringFormat=\{0:N2\}}" Width="120" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" Binding="{Binding LineTotal, StringFormat=\{0:N2\}}" Width="120" IsReadOnly="True"/>
                                <DataGridTemplateColumn Header="Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹" Width="150">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock>
                                                <TextBlock.Text>
                                                    <MultiBinding Converter="{StaticResource WarehouseIdToName}">
                                                        <Binding Path="WarehouseId"/>
                                                        <Binding Path="DataContext.Warehouses" RelativeSource="{RelativeSource AncestorType=Window}"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª" Binding="{Binding Remarks}" Width="*" IsReadOnly="True"/>
                    </DataGrid.Columns>
                </DataGrid>

                        <!-- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª -->
                        <Grid Grid.Row="3" Margin="0,14,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="200"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª" Style="{StaticResource SectionTitle}" VerticalAlignment="Center"/>

                            <TextBlock Grid.Column="1" Text="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" VerticalAlignment="Center" Margin="8,0"/>
                            <TextBox Grid.Column="2" Text="{Binding TotalAmount, StringFormat=\{0:N2\}}"
                                     IsReadOnly="True" HorizontalContentAlignment="Right"/>
                        </Grid>
                    </Grid>
        </Border>

                <!-- ØªÙ„Ù…ÙŠØ­ -->
                <TextBlock Grid.Row="3" Margin="4,10,0,0"
                           Text="ðŸ’¡ Ù†ØµÙŠØ­Ø©: ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø³Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±."
                           Foreground="{StaticResource Clr.Muted}"/>
    </Grid>
        </ScrollViewer>
    </DockPanel>
</Window>
