# ุฏูุฑุฉ ุงููุณุชูุฏูุฉ ูููุงุชูุฑ ุงููุดุชุฑูุงุช ูุงููุฑุชุฌุนุงุช (PI/PR)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅููุงู ุชุทุจูู ุฏูุฑุฉ ุงููุณุชูุฏูุฉ ุงููุงููุฉ ูููุงุชูุฑ ุงููุดุชุฑูุงุช ูุงููุฑุชุฌุนุงุช ุญุณุจ ุงูุฏููู ุงูุชูููุฐู ุงูููุตู. ูุดูู ุงููุธุงู ุฌููุน ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ ูุงูุชุญุณููุงุช ุงููุทููุจุฉ.

## ๐ฏ ุงูููุฒุงุช ุงููุทุจูุฉ

### 1. **ุชุญุณููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช**
- โ **ููุงุฐุฌ ุงูุจูุงูุงุช ูุญุณูุฉ** - ูุชูุงููุฉ ูุน ุงูุฏููู ุงูุชูููุฐู
- โ **ููุงุฑุณ ูุญุณูุฉ** - ูุถูุงู ุงูุฃุฏุงุก ูุงูุฃูุงู
- โ **ูููุฏ ุงูุจูุงูุงุช** - ูููุน ุงูุฃุฎุทุงุก ูุงูุชูุงูุถุงุช
- โ **ุฅุฌุฑุงุกุงุช SQL ูุงููุฉ** - ูุฌููุน ุงูุนูููุงุช ุงูุฃุณุงุณูุฉ

### 2. **ููุทู ุญุณุงุจ ุงูุถุฑุงุฆุจ ุงููุญุณู**
- โ **ุญุณุงุจ ุฏููู ููุถุฑุงุฆุจ** - ุญุณุจ ุงูุฏููู ุงูุชูููุฐู
- โ **ุฏุนู ุงูุณุนุฑ ุงูุดุงูู/ุบูุฑ ุงูุดุงูู** - ููุถุฑูุจุฉ
- โ **ุชูุฑูุจ ุตุญูุญ** - ููุฃุณุงุณ ูุงูุถุฑูุจุฉ ูุงูุฅุฌูุงูู
- โ **ูุนุงูุฌุฉ ูุฑูู ุงูุชูุฑูุจ** - ูุชุฌูุจ ุงูุฃุฎุทุงุก

### 3. **ูุธุงู ุงูุชุญูู ุงูุดุงูู**
- โ **ุงูุชุญูู ูู ุงูููุฑุฏ** - ูุฌูุฏู ูุญุณุงุจู ุงููุญุงุณุจู
- โ **ููุน ุงูุชูุฑุงุฑ** - ูุฑูู ุงููุณุชูุฏ ูุฑูู ูุงุชูุฑุฉ ุงูููุฑุฏ
- โ **ุงูุชุญูู ูู ุงููููุงุช** - ุนุฏู ุชุฌุงูุฒ ุงููููุงุช ุงููุณุชููุฉ
- โ **ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ** - ูููุณุชุฎุฏู

### 4. **ุงูุชุฑุญูู ุงููุญุงุณุจู ุงููุญุณู**
- โ **ุงูุณูุงุณุฉ (ุจ) ุงููุทุจูุฉ** - ูุฏูู GRNIุ ุฏุงุฆู ุงูููุฑุฏ
- โ **ูุนุงููุงุช ุขููุฉ** - ูุน ุงูุฃููุงู ูุงูุชุฑุงุฌุน
- โ **ุนูุณ ุงูุชุฑุญูู** - ูุน ุฅูุดุงุก ูููุฏ ุนูุณูุฉ
- โ **ุฑุจุท ุงููููุฏ** - ุจุฑูู ุงููุณุชูุฏ

### 5. **ุงููุทุงุจูุฉ ูุน ุณูุฏุงุช ุงูุงุณุชูุงู**
- โ **ุฑุจุท ุจุณูุฏุงุช ุงูุงุณุชูุงู** - RelatedReceiptId
- โ **ุฑุจุท ุจุฃูุงูุฑ ุงูุดุฑุงุก** - RelatedPOId
- โ **ููุน ุงูุชุฌุงูุฒ** - ูููููุงุช ุงููุณุชููุฉ
- โ **ุชุชุจุน ุงููููุงุช ุงููุชุจููุฉ** - ููู ุณุทุฑ ุงุณุชูุงู

## ๐ง ุงููููุงุช ุงููุญุฏุซุฉ

### **ุงูุฎุฏูุงุช (Services)**
- `PurchaseAPService.cs` - ููุทู ุงูุนูู ุงููุญุณู
- `IPurchaseAPService.cs` - ูุงุฌูุฉ ุงูุฎุฏูุฉ ุงููุญุฏุซุฉ

### **ุงูููุงุฐุฌ (Models)**
- `PurchaseAP.cs` - ูููุฐุฌ ุงูุฑุฃุณ ูุญุณู
- `PurchaseAPDetail.cs` - ูููุฐุฌ ุงูุชูุงุตูู ูุญุณู

### **ูุงุฌูุงุช ุงููุณุชุฎุฏู (ViewModels)**
- `PurchaseAPEditViewModel.cs` - ููุทู ุงูุชุญุฑูุฑ ูุญุณู
- `PurchaseAPListViewModel.cs` - ููุทู ุงููุงุฆูุฉ ูุญุณู

### **ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database)**
- `PurchaseAP_StoredProcedures.sql` - ุฅุฌุฑุงุกุงุช SQL ูุงููุฉ

## ๐ ุฏูุฑุฉ ุญูุงุฉ ุงููุณุชูุฏ

### **1. ุฅูุดุงุก ุงููุณุชูุฏ**
```
ุงููุณุชุฎุฏู โ ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ โ ุชุนุจุฆุฉ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
```

### **2. ุงุฎุชูุงุฑ ุณูุฏ ุงูุงุณุชูุงู**
```
ุงููุณุชุฎุฏู โ ุงุณุชุนุฑุงุถ ุณูุฏุงุช ุงูุงุณุชูุงู โ ุงุฎุชูุงุฑ ุงูุณูุฏ ุงูููุงุณุจ
```

### **3. ุฅุถุงูุฉ ุงูุชูุงุตูู**
```
ุงููุณุชุฎุฏู โ ุฅุถุงูุฉ ุงูุฃุตูุงู โ ุงููุธุงู ูุญุณุจ ุงูุถุฑุงุฆุจ ุชููุงุฆูุงู
```

### **4. ุงูุชุญูู ูู ุงูุจูุงูุงุช**
```
ุงููุธุงู โ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช โ ุนุฑุถ ุงูุฃุฎุทุงุก ุฅู ูุฌุฏุช
```

### **5. ุญูุธ ุงููุณุชูุฏ**
```
ุงููุณุชุฎุฏู โ ุญูุธ โ ุงููุธุงู ูุชุญูู ููุญูุธ ุงูุจูุงูุงุช
```

### **6. ุชุฑุญูู ุงููุณุชูุฏ**
```
ุงููุณุชุฎุฏู โ ุชุฑุญูู โ ุงููุธุงู ููุดุฆ ุงูููุฏ ุงููุญุงุณุจู
```

## ๐งฎ ุญุณุงุจ ุงูุถุฑุงุฆุจ

### **ุงูุณุนุฑ ุบูุฑ ุดุงูู ุงูุถุฑูุจุฉ**
```
ุงูุฃุณุงุณ = ุงููููุฉ ร ุงูุณุนุฑ ร ุณุนุฑ ุงูุตุฑู
ุงูุถุฑูุจุฉ = ุงูุฃุณุงุณ ร (ูุณุจุฉ ุงูุถุฑูุจุฉ / 100)
ุงูุฅุฌูุงูู = ุงูุฃุณุงุณ + ุงูุถุฑูุจุฉ
```

### **ุงูุณุนุฑ ุดุงูู ุงูุถุฑูุจุฉ**
```
ุงูุฃุณุงุณ = ุงูุฅุฌูุงูู / (1 + ูุณุจุฉ ุงูุถุฑูุจุฉ / 100)
ุงูุถุฑูุจุฉ = ุงูุฅุฌูุงูู - ุงูุฃุณุงุณ
ุงูุฅุฌูุงูู = ุงูุฃุณุงุณ + ุงูุถุฑูุจุฉ
```

## ๐ ุงูุชุฑุญูู ุงููุญุงุณุจู

### **ูุงุชูุฑุฉ ุงููุดุชุฑูุงุช (PI)**
```
ูุฏูู: ุญุณุงุจ GRNI (Goods Received Not Invoiced)
ุฏุงุฆู: ุญุณุงุจ ุงูููุฑุฏ
```

### **ูุฑุชุฌุน ุงููุดุชุฑูุงุช (PR)**
```
ูุฏูู: ุญุณุงุจ ุงูููุฑุฏ
ุฏุงุฆู: ุญุณุงุจ GRNI
```

## ๐ ุงููุทุงุจูุฉ (3-Way Match)

### **ุงููุทุงุจูุฉ ุงููุงููุฉ**
- โ ุฃูุฑ ุงูุดุฑุงุก (PO)
- โ ุณูุฏ ุงูุงุณุชูุงู (GRN)
- โ ูุงุชูุฑุฉ ุงููุดุชุฑูุงุช (PI)

### **ุงูุชุญูู ูู ุงููููุงุช**
- โ ุงููููุฉ ุงููููุชุฑุฉ โค ุงููููุฉ ุงููุณุชููุฉ
- โ ุชุชุจุน ุงููููุงุช ุงููุชุจููุฉ ููู ุณุทุฑ
- โ ููุน ุงูููุชุฑุฉ ุงูุฒุงุฆุฏุฉ

## ๐ก๏ธ ุงูุฃูุงู ูุงูุงุณุชูุฑุงุฑ

### **ุงูุฃููุงู ูุงููุนุงููุงุช**
- โ ุฃููุงู UPDLOCK ุนูู ุงููุณุชูุฏุงุช
- โ ูุนุงููุงุช ูุน XACT_ABORT ON
- โ ุชุฑุงุฌุน ุชููุงุฆู ุนูุฏ ุงูุฃุฎุทุงุก

### **ุงูุชุญูู ุงููุชุนุฏุฏ ุงููุณุชููุงุช**
- โ ุงูุชุญูู ูู ุงููุงุฌูุฉ (ููุฑู)
- โ ุงูุชุญูู ูู ุงูุฎุฏูุฉ (ููุงุนุฏ ุงูุนูู)
- โ ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูููุฏ)

## ๐ ูุงุฆูุฉ ุงูุชุญูู

### **ูุจู ุงูุญูุธ**
- [ ] ุงูููุฑุฏ ููุฌูุฏ ููู ุญุณุงุจ ูุญุงุณุจู
- [ ] ุฑูู ุงููุณุชูุฏ ุบูุฑ ููุฑุฑ
- [ ] ุฑูู ูุงุชูุฑุฉ ุงูููุฑุฏ ุบูุฑ ููุฑุฑ (ููููุงุชูุฑ)
- [ ] ุฌููุน ุงููููุงุช ููุฌุจุฉ
- [ ] ุฌููุน ุงูุฃุณุนุงุฑ ุบูุฑ ุณุงูุจุฉ
- [ ] ูุณุจ ุงูุถุฑุงุฆุจ ุตุญูุญุฉ (0-100%)

### **ูุจู ุงูุชุฑุญูู**
- [ ] ุงููุณุชูุฏ ูุญููุธ (Status = 1)
- [ ] ุฌููุน ุงูุชุญููุงุช ุงูุณุงุจูุฉ ุตุญูุญุฉ
- [ ] ุงููููุงุช ูุง ุชุชุฌุงูุฒ ุงููุณุชููุฉ
- [ ] ุญุณุงุจ ุงูููุฑุฏ ููุฌูุฏ
- [ ] ุญุณุงุจ GRNI ูุนุฑู

## ๐ ุงูุฅุฌุฑุงุกุงุช SQL ุงููุชุงุญุฉ

### **ุงูุชุญูู ูุงูุญุณุงุจ**
- `sp_PurchaseAP_Validate` - ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- `sp_PurchaseAP_CalculateTotals` - ุญุณุงุจ ุงูุถุฑุงุฆุจ ูุงููุฌุงููุน
- `sp_PurchaseAP_GenerateNextNumber` - ุชูููุฏ ุฑูู ุงููุณุชูุฏ ุงูุชุงูู

### **ุงูุชุฑุญูู**
- `sp_PurchaseAP_Post` - ุชุฑุญูู ุงููุณุชูุฏ
- `sp_PurchaseAP_Unpost` - ุนูุณ ุงูุชุฑุญูู
- `sp_PurchaseAP_CreateJournalEntry` - ุฅูุดุงุก ุงูููุฏ ุงููุญุงุณุจู
- `sp_PurchaseAP_ReverseJournalEntry` - ุนูุณ ุงูููุฏ ุงููุญุงุณุจู

### **ุงูุงุณุชุนูุงูุงุช ูุงูุชูุงุฑูุฑ**
- `sp_PurchaseAP_GetBySupplier` - ููุงุชูุฑ ุงูููุฑุฏ
- `sp_PurchaseAP_GetRemainingQuantity` - ุงููููุฉ ุงููุชุจููุฉ
- `sp_PurchaseAP_MatchingReport` - ุชูุฑูุฑ ุงููุทุงุจูุฉ

## ๐ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### **ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ**
```csharp
var purchaseAP = new PurchaseAP
{
    DocType = "PI",
    DocDate = DateTime.Today,
    SupplierId = 1,
    CompanyId = 1,
    BranchId = 1
};

var details = new List<PurchaseAPDetail>
{
    new PurchaseAPDetail
    {
        ItemId = 1,
        Quantity = 10,
        UnitPrice = 100,
        VATRate = 15
    }
};

await _service.AddAsync(purchaseAP, details);
```

### **ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช**
```csharp
var errors = await _service.GetValidationErrorsAsync(purchaseAP, details);
if (errors.Any())
{
    // ุนุฑุถ ุงูุฃุฎุทุงุก ูููุณุชุฎุฏู
    var errorMessage = string.Join("\n", errors);
    MessageBox.Show(errorMessage);
}
```

### **ุชุฑุญูู ุงููุณุชูุฏ**
```csharp
var success = await _service.PostAsync(apId, userId);
if (success)
{
    MessageBox.Show("ุชู ุชุฑุญูู ุงููุณุชูุฏ ุจูุฌุงุญ");
}
```

## ๐ ุงูููุงุฑุณ ุงููุทููุจุฉ

### **ููุงุฑุณ ุงููุฑูุฏุฉ**
- `UQ_PurchaseAP_Number` - ูุฑูุฏุฉ ุฑูู ุงููุณุชูุฏ
- `UQ_PurchaseAP_SupplierRef` - ูุฑูุฏุฉ ุฑูู ูุงุชูุฑุฉ ุงูููุฑุฏ

### **ููุงุฑุณ ุงูุฃุฏุงุก**
- `IX_PurchaseAP_Supplier` - ุงูููุฑุฏ ูุงูุชุงุฑูุฎ
- `IX_PurchaseAP_Receipt` - ุณูุฏ ุงูุงุณุชูุงู
- `IX_PAPDetails_AP` - ุชูุงุตูู ุงููุณุชูุฏ
- `IX_PAPDetails_Item` - ุงูุตูู ูุงููุณุชูุฏุน
- `IX_PAPDetails_PO` - ุฃูุฑ ุงูุดุฑุงุก
- `IX_PAPDetails_RCPT` - ุณูุฏ ุงูุงุณุชูุงู

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅููุงู ุชุทุจูู ุฏูุฑุฉ ุงููุณุชูุฏูุฉ ุงููุงููุฉ ูููุงุชูุฑ ุงููุดุชุฑูุงุช ูุงููุฑุชุฌุนุงุช ุจูุฌุงุญ. ุงููุธุงู ุงูุขู ูุฏุนู:

- โ **ุญุณุงุจ ุงูุถุฑุงุฆุจ ุงูุฏููู** ุญุณุจ ุงููุนุงููุฑ ุงููุญุงุณุจูุฉ
- โ **ุงูุชุญูู ุงูุดุงูู** ูู ุตุญุฉ ุงูุจูุงูุงุช
- โ **ุงูุชุฑุญูู ุงููุญุงุณุจู ุงูุขูู** ูุน ุงููุนุงููุงุช
- โ **ุงููุทุงุจูุฉ ุงููุงููุฉ** ูุน ุณูุฏุงุช ุงูุงุณุชูุงู
- โ **ุงูุฃูุงู ูุงูุงุณุชูุฑุงุฑ** ูุน ุงูุฃููุงู ูุงููุนุงููุงุช
- โ **ุงูุฃุฏุงุก ุงููุญุณู** ูุน ุงูููุงุฑุณ ุงูููุงุณุจุฉ

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ ูุน ุถูุงู ุงูุฏูุฉ ูุงูุฃูุงู ูู ุฌููุน ุงูุนูููุงุช ุงููุญุงุณุจูุฉ.
